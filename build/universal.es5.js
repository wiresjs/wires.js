"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(e){var t=e.isNode,n=e.realm;n.module("wires.Router",["utils.lodash"],function(e){var t,n=function(){function e(t){_classCallCheck(this,e),this["package"]=t["package"]||""}return _createClass(e,[{key:"setupUserURL",value:function(e){this.userURL=e}},{key:"getURLSnippets",value:function(){var e=(this.userURL||window.location.pathname).split("/");return e=e.splice(1,e.length),1===e.length?[]:e}},{key:"root",value:function(e,t){return this.root=this.state("/",e,t),this}},{key:"state",value:function(e,t,n){var i=t.split(/\s+->\s+/),r=i[0];r=(this["package"]?this["package"]+".":"")+r;var s=i[1];return{ctrl:r,view:s,path:e,states:n}}},{key:"start",value:function(){var e=this.getURLSnippets();console.log(e),console.log(this.root)}}]),e}();return t=n}),n.module("utils.lodash",function(){return t?require("lodash"):window._}),n.module("utils.Promise",function(){return t?Promise:window.Promise});var i=t?require("async-watch"):void 0;n.module("wires.AsyncWatch",function(){return t?i.AsyncWatch:window.AsyncWatch}),n.module("realm",function(){return n}),n.module("nodejs.utils.stream",function(){return t?require("event-stream"):{}}),n.module("nodejs.utils.fs",function(){return t?require("fs"):{}}),n.module("nodejs.utils.walk",function(){return t?require("walk"):{}}),n.module("nodejs.utils.path",function(){return t?require("path"):{}}),n.module("AsyncTransaction",function(){return t?i.AsyncTransaction:window.AsyncTransaction}),n.module("wires.utils.DotNotation",["wires.AsyncWatch"],function(e){var t,n={nextTick:function(e){return isNode?process.nextTick(e):window.requestAnimationFrame(e)},dotNotation:function(e){if(e instanceof Array)return{path:e,str:e.join(".")};if("string"==typeof e)return{path:e.split("."),str:e}},hasProperty:function(e,t){if(t&&0===t.length||void 0===e)return!1;var n=this.dotNotation(t);if(!n)return!1;t=n.path;for(var i=!0,r=0;r<t.length;r++){if(!i||!e.hasOwnProperty(t[r]))return!1;e=e[t[r]],void 0===e&&(i=!1)}return!0},getPropertyValue:function(e,t){if(0!==t.length&&void 0!==e){var n=this.dotNotation(t);if(n){t=n.path;for(var i=0;i<t.length;i++)if(e=e[t[i]],void 0===e)return;return e}}}};return t=n}),n.module("wires.utils.Properties",[],function(){var e,t=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"defineHidden",value:function(e,t,n){return Object.defineProperty(e,t,{enumerable:!1,value:n}),e}}]),e}();return e=t}),n.module("wires.services.Watch",["wires.expressions.AngularExpressions","wires.expressions.WatchBatch","utils.lodash"],function(e,t,n){var i,r=function(n,i,r,s){var a,o=n.scope||{},u=n.locals||{},c=e.extract(i),l=e.compile(i);return s&&(a=l(o,u),r(a,void 0,{})),t({locals:u,scope:o,batch:c},function(e){var t=l(o,u);r(t,a,e),a=t})};return i=r}),n.module("wires.runtime.Directives",["realm"],function(e){var t;return t=e.requirePackage("wires.directives")}),n.module("wires.runtime.Schema",["utils.lodash"],function(e){var t;return t=n.requirePackage("wires.schema").then(function(t){var n={};return e.each(t,function(t){n=e.merge(n,t)}),n})}),n.module("wires.htmlparser.AttributeAnalyzer",["wires.htmlparser.State"],function(e){var t,n=0,i=(n++).toString(),r=(n++).toString(),s=(n++).toString(),a=(n++).toString(),o=(n++).toString(),u=(n++).toString(),c=(n++).toString(),l=(n++).toString(),h=(n++).toString(),f=(n++).toString(),p=(n++).toString(),v=(n++).toString(),d=(n++).toString(),m=((n++).toString(),function(){function t(){_classCallCheck(this,t),this.state=new e,this.state.set(i)}return _createClass(t,[{key:"consumeName",value:function(){return this.state.has(r)}},{key:"closeName",value:function(){return this.state.has(s)}},{key:"startAttrName",value:function(){return this.state.has(o)}},{key:"consumeAttrName",value:function(){return this.state.has(u)}},{key:"closeAttrName",value:function(){return this.state.has(c)}},{key:"consumeAttrValue",value:function(){return this.state.has(p)}},{key:"closeAttrValue",value:function(){return this.state.has(p)}},{key:"analyze",value:function(e){var t=this.state;return t.clean(s,o,c),void 0===e?this:(t.has(p)&&("\\"===e&&(t.unset(p),t.set(v)),e===this.quote&&(t.unset(p),t.set(d,a))),t.has(v)&&e===this.quote&&(t.unset(v),t.set(p)),t.has(f)&&(t.unset(f),t.set(p)),t.has(l)&&(e.match(/[=\s"']/)?(t.has(h)&&("'"!==e&&'"'!==e||(this.quote=e,t.unset(l,h),t.set(f))),"="===e&&t.set(h)):(t.unset(l,h),t.set(a))),t.has(u)&&(e.match(/[a-z0-9_-]/)||(t.unset(u),t.set(c,l),"="===e&&t.set(h))),t.has(a)&&e.match(/[a-z0-9_-]/)&&(t.unset(a),t.set(o,u)),t.has(i)&&e.match(/[a-z0-9_-]/)&&(t.unset(i),t.set(r)),t.has(r)&&(e.match(/[a-z0-9_-]/)||(t.unset(r),t.set(s),t.set(a))),this.prev=e,this)}}]),t}());return t=m}),n.module("wires.htmlparser.Parser",["utils.lodash","wires.htmlparser.TagAnalyzer","wires.htmlparser.Tag","wires.htmlparser.Text"],function(e,t,n,i){var r,s=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],a=function(){function r(){_classCallCheck(this,r)}return _createClass(r,null,[{key:"parse",value:function(a,o){for(var u,c=new t,l=new n,h=0;h<a.length;h++){var f=a[h],p=h===a.length-1;if(c.analyze(f,p),c.isCreated()){var v=new n(l);v.parse(f),l.addTag(v),l=v}else c.isOpened()?l.parse(f):c.isClosed()?(l.consumed||l.consume(c),l.name&&(l=l.parent)):c.isConsumed()?(l.consume(c),l.consumed=!0,e.indexOf(s,l.name)>-1&&(l.autoClosed=!0,l=l.parent)):c.isText()?(u=u||"",u+=f,p&&l&&l.addText(new i(u))):c.isTextEnd()&&(l&&l.addText(new i(u)),u=void 0)}return l?o?r.toJSON(l.children):l.children:[]}},{key:"toJSON",value:function(t){var i=[];return e.each(t,function(t){var s={},a=t instanceof n;s.type=a?"tag":"text";var o={};e.each(t.attrs,function(e){o[e[0]]=e[1]}),e.keys(o).length&&(s.attrs=o),t.str&&(s.value=t.str),t.name&&(s.name=t.name),t.children&&t.children.length&&(s.children=r.toJSON(t.children)),(a||!a&&s.value)&&i.push(s)}),i}}]),r}();return r=a}),n.module("wires.htmlparser.State",[],function(){var e,t=function(){function e(){_classCallCheck(this,e),this.$states=new Set}return _createClass(e,[{key:"set",value:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];this.$states.has(t)||this.$states.add(t)}}},{key:"clean",value:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];this.$states["delete"](t)}}},{key:"has",value:function(e){return this.$states.has(e)}},{key:"once",value:function(e){var t=this.$states.has(e);return t&&this.$states["delete"](e),t}},{key:"unset",value:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];this.$states["delete"](t)}}}]),e}();return e=t}),n.module("wires.htmlparser.Tag",["wires.htmlparser.AttributeAnalyzer","utils.lodash"],function(e,t){var n,i=function(){function t(e){_classCallCheck(this,t),this.parent=e,this.name="",this.children=[],this.attrs=[],this.raw=""}return _createClass(t,[{key:"addAttribute",value:function(){this.attrs.push(["",""])}},{key:"add2AttributeName",value:function(e){var t=this.attrs.length-1;this.attrs[t][0]+=e}},{key:"add2AttributeValue",value:function(e){var t=this.attrs.length-1;this.attrs[t][1]+=e}},{key:"addTag",value:function(e){this.children.push(e)}},{key:"consume",value:function(t){for(var n=new e,i=0;i<this.raw.length;i++){var r=this.raw[i],s=n.analyze(r);s.consumeName()&&(this.name+=r),s.startAttrName()&&this.addAttribute(),s.consumeAttrName()&&this.add2AttributeName(r),s.consumeAttrValue()&&this.add2AttributeValue(r)}}},{key:"addText",value:function(e){this.children.push(e)}},{key:"parse",value:function(e){this.raw+=e}}]),t}();return n=i}),n.module("wires.htmlparser.TagAnalyzer",["wires.htmlparser.State"],function(e){var t,n="1",i="2",r="3",s="4",a="5",o="6",u="7",c="8",l="9",h=function(){function t(){_classCallCheck(this,t),this.state=new e}return _createClass(t,[{key:"isCreated",value:function(){return this.state.has(s)}},{key:"isOpened",value:function(){return this.state.has(n)}},{key:"isClosed",value:function(){return this.state.has(r)}},{key:"isText",value:function(){return this.state.has(u)}},{key:"isConsumed",value:function(){return this.state.has(l)}},{key:"isTextEnd",value:function(){return this.state.has(c)}},{key:"closeTag",value:function(){this.state.unset(a,n,n),this.state.set(l)}},{key:"analyze",value:function(e,t){var h=this.state;if(h.has(o)&&h.set(u),h.clean(r,c,o,l),"/"===e&&h.has(a)&&(h.set(i),h.unset(a,n)),h.has(s)&&(h.unset(s),h.set(n)),h.has(a)&&(h.set(s),h.unset(a)),"<"===e&&(h.has(n)||h.set(a),h.has(u)&&h.set(c),h.unset(u,o)),">"===e){if(h.set(o),h.once(i))return h.unset(n),h.set(r);h.set(l),h.has(n)&&h.unset(n)}}}]),t}();return t=h}),n.module("wires.htmlparser.Text",[],function(){var e,t=function(){function e(t){_classCallCheck(this,e),this.str=t}return _createClass(e,[{key:"closed",value:function(){}}]),e}();return e=t}),n.module("wires.expressions.AngularExpressionParser",[],function(){function e(){}function t(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function n(e){return"undefined"!=typeof e}function i(e){return function(){return e}}function r(e,t,n,i,r){var s=arguments;throw t=t.replace(/{(\d)}/g,function(e){return s[2+parseInt(e[1])]}),new SyntaxError(t)}function s(e){return"string"==typeof e?e.toLowerCase():e}function a(e,t){e.forEach(t)}function o(e,t){if("constructor"===e)throw r("isecfld",'Referencing "constructor" field in Angular expressions is disallowed! Expression: {0}',t);return e}function u(e,t){if(e){if(e.constructor===e)throw r("isecfn","Referencing Function in Angular expressions is disallowed! Expression: {0}",t);if(e.document&&e.location&&e.alert&&e.setInterval)throw r("isecwindow","Referencing the Window in Angular expressions is disallowed! Expression: {0}",t);if(e.children&&(e.nodeName||e.prop&&e.attr&&e.find))throw r("isecdom","Referencing DOM nodes in Angular expressions is disallowed! Expression: {0}",t)}return e}function c(e,t,n,i){for(var r,s=t.split("."),a=0;s.length>1;a++){r=o(s.shift(),i);var u=e[r];u||(u={},e[r]=u),e=u}return r=o(s.shift(),i),e[r]=n,n}function l(e,t,n,i,r,s){return o(e,s),o(t,s),o(n,s),o(i,s),o(r,s),function(s,a){var o=a&&a.hasOwnProperty(e)?a:s;if(null==o)return o;if(o=o[e],!t)return o;if(null!=o){if(o=o[t],!n)return o;if(null!=o){if(o=o[n],!i)return o;if(null!=o){if(o=o[i],!r)return o;if(null!=o)return o=o[r]}}}}}function h(e,t){return o(e,t),function(t,n){if(null!=t)return(n&&n.hasOwnProperty(e)?n:t)[e]}}function f(e,t,n){return o(e,n),o(t,n),function(n,i){if(null!=n)return n=(i&&i.hasOwnProperty(e)?i:n)[e],null==n?void 0:n[t]}}function p(e,t,n){if(k.hasOwnProperty(e))return k[e];var r,s=e.split("."),u=s.length;if(1===u)r=h(s[0],n);else if(2===u)r=f(s[0],s[1],n);else if(t.csp)r=u<6?l(s[0],s[1],s[2],s[3],s[4],n,t):function(e,i){var r,a=0;do r=l(s[a++],s[a++],s[a++],s[a++],s[a++],n,t)(e,i),i=void 0,e=r;while(a<u);return r};else{var c="var p;\n";a(s,function(e,t){o(e,n),c+="if(s == null) return undefined;\ns="+(t?"s":'((k&&k.hasOwnProperty("'+e+'"))?k:s)')+'["'+e+'"];\n'}),c+="return s;";var p=new Function("s","k","pw",c);p.toString=i(c),r=p}return"hasOwnProperty"!==e&&(k[e]=r),r}var v,d={"null":function(){return null},"true":function(){return!0},"false":function(){return!1},undefined:e,"+":function(e,t,i,r){return i=i(e,t),r=r(e,t),n(i)?n(r)?i+r:i:n(r)?r:void 0},"-":function(e,t,i,r){return i=i(e,t),r=r(e,t),(n(i)?i:0)-(n(r)?r:0)},"*":function(e,t,n,i){return n(e,t)*i(e,t)},"/":function(e,t,n,i){return n(e,t)/i(e,t)},"%":function(e,t,n,i){return n(e,t)%i(e,t)},"^":function(e,t,n,i){return n(e,t)^i(e,t)},"=":e,"===":function(e,t,n,i){return n(e,t)===i(e,t)},"!==":function(e,t,n,i){return n(e,t)!==i(e,t)},"==":function(e,t,n,i){return n(e,t)==i(e,t)},"!=":function(e,t,n,i){return n(e,t)!=i(e,t)},"<":function(e,t,n,i){return n(e,t)<i(e,t)},">":function(e,t,n,i){return n(e,t)>i(e,t)},"<=":function(e,t,n,i){return n(e,t)<=i(e,t)},">=":function(e,t,n,i){return n(e,t)>=i(e,t)},"&&":function(e,t,n,i){return n(e,t)&&i(e,t)},"||":function(e,t,n,i){return n(e,t)||i(e,t)},"&":function(e,t,n,i){return n(e,t)&i(e,t)},"|":function(e,t,n,i){return i(e,t)(e,t,n(e,t))},"!":function(e,t,n){return!n(e,t)}},m={n:"\n",f:"\f",r:"\r",t:"\t",v:"\x0B","'":"'",'"':'"'},y=function(e){this.options=e};y.prototype={constructor:y,lex:function(e){this.text=e,this.index=0,this.ch=void 0,this.lastCh=":",this.tokens=[];for(var t,n=[];this.index<this.text.length;){if(this.ch=this.text.charAt(this.index),this.is("\"'"))this.readString(this.ch);else if(this.isNumber(this.ch)||this.is(".")&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdent(this.ch))this.readIdent(),this.was("{,")&&"{"===n[0]&&(t=this.tokens[this.tokens.length-1])&&(t.json=t.text.indexOf(".")===-1);else if(this.is("(){}[].,;:?"))this.tokens.push({index:this.index,text:this.ch,json:this.was(":[,")&&this.is("{[")||this.is("}]:,")}),this.is("{[")&&n.unshift(this.ch),this.is("}]")&&n.shift(),this.index++;else{if(this.isWhitespace(this.ch)){this.index++;continue}var i=this.ch+this.peek(),r=i+this.peek(2),s=d[this.ch],a=d[i],o=d[r];o?(this.tokens.push({index:this.index,text:r,fn:o}),this.index+=3):a?(this.tokens.push({index:this.index,text:i,fn:a}),this.index+=2):s?(this.tokens.push({index:this.index,text:this.ch,fn:s,json:this.was("[,:")&&this.is("+-")}),this.index+=1):this.throwError("Unexpected next character ",this.index,this.index+1)}this.lastCh=this.ch}return this.tokens},is:function(e){return e.indexOf(this.ch)!==-1},was:function(e){return e.indexOf(this.lastCh)!==-1},peek:function(e){var t=e||1;return this.index+t<this.text.length&&this.text.charAt(this.index+t)},isNumber:function(e){return"0"<=e&&e<="9"},isWhitespace:function(e){return" "===e||"\r"===e||"\t"===e||"\n"===e||"\x0B"===e||"Â "===e},isIdent:function(e){return"a"<=e&&e<="z"||"A"<=e&&e<="Z"||"_"===e||"$"===e},isExpOperator:function(e){return"-"===e||"+"===e||this.isNumber(e)},throwError:function(e,t,i){i=i||this.index;var s=n(t)?"s "+t+"-"+this.index+" ["+this.text.substring(t,i)+"]":" "+i;throw r("lexerr","Lexer Error: {0} at column{1} in expression [{2}].",e,s,this.text)},readNumber:function(){for(var e="",t=this.index;this.index<this.text.length;){var n=s(this.text.charAt(this.index));if("."==n||this.isNumber(n))e+=n;else{var i=this.peek();if("e"==n&&this.isExpOperator(i))e+=n;else if(this.isExpOperator(n)&&i&&this.isNumber(i)&&"e"==e.charAt(e.length-1))e+=n;else{if(!this.isExpOperator(n)||i&&this.isNumber(i)||"e"!=e.charAt(e.length-1))break;this.throwError("Invalid exponent")}}this.index++}e=1*e,this.tokens.push({index:t,text:e,json:!0,fn:function(){return e}})},readIdent:function(){for(var e,n,i,r,s=this,a="",o=this.index;this.index<this.text.length&&(r=this.text.charAt(this.index),"."===r||this.isIdent(r)||this.isNumber(r));)"."===r&&(e=this.index),a+=r,this.index++;if(e)for(n=this.index;n<this.text.length;){if(r=this.text.charAt(n),"("===r){i=a.substr(e-o+1),a=a.substr(0,e-o),this.index=n;break}if(!this.isWhitespace(r))break;n++}var u={index:o,text:a};if(d.hasOwnProperty(a))u.fn=d[a],u.json=d[a];else{var l=p(a,this.options,this.text);u.fn=t(function(e,t){return l(e,t)},{assign:function(e,t){return c(e,a,t,s.text,s.options)}})}this.tokens.push(u),i&&(this.tokens.push({index:e,text:".",json:!1}),this.tokens.push({index:e+1,text:i,json:!1}))},readString:function(e){var t=this.index;this.index++;for(var n="",i=e,r=!1;this.index<this.text.length;){var s=this.text.charAt(this.index);if(i+=s,r){if("u"===s){var a=this.text.substring(this.index+1,this.index+5);a.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+a+"]"),this.index+=4,n+=String.fromCharCode(parseInt(a,16))}else{var o=m[s];n+=o?o:s}r=!1}else if("\\"===s)r=!0;else{if(s===e)return this.index++,void this.tokens.push({index:t,text:i,string:n,json:!0,fn:function(){return n}});n+=s}this.index++}this.throwError("Unterminated quote",t)}};var g=function(e,t,n){this.lexer=e,this.$filter=t,this.options=n};g.ZERO=function(){return 0},g.prototype={constructor:g,parse:function(e){this.text=e,this.tokens=this.lexer.lex(e);var t=this.statements();return 0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]),t.literal=!!t.literal,t.constant=!!t.constant,t},tokenize:function(e){return this.text=e,this.tokens=this.lexer.lex(e),this.tokens},primary:function w(){var w;if(this.expect("("))w=this.filterChain(),this.consume(")");else if(this.expect("["))w=this.arrayDeclaration();else if(this.expect("{"))w=this.object();else{var e=this.expect();w=e.fn,w||this.throwError("not a primary expression",e),e.json&&(w.constant=!0,w.literal=!0)}for(var t,n;t=this.expect("(","[",".");)"("===t.text?(w=this.functionCall(w,n),n=null):"["===t.text?(n=w,w=this.objectIndex(w)):"."===t.text?(n=w,w=this.fieldAccess(w)):this.throwError("IMPOSSIBLE");return w},throwError:function(e,t){throw r("syntax","Syntax Error: Token '{0}' {1} at column {2} of the expression [{3}] starting at [{4}].",t.text,e,t.index+1,this.text,this.text.substring(t.index))},peekToken:function(){if(0===this.tokens.length)throw r("ueoe","Unexpected end of expression: {0}",this.text);return this.tokens[0]},peek:function(e,t,n,i){if(this.tokens.length>0){var r=this.tokens[0],s=r.text;if(s===e||s===t||s===n||s===i||!e&&!t&&!n&&!i)return r}return!1},expect:function(e,t,n,i){var r=this.peek(e,t,n,i);return!!r&&(this.tokens.shift(),r)},consume:function(e){this.expect(e)||this.throwError("is unexpected, expecting ["+e+"]",this.peek())},unaryFn:function(e,n){return t(function(t,i){return e(t,i,n)},{constant:n.constant})},ternaryFn:function(e,n,i){return t(function(t,r){return e(t,r)?n(t,r):i(t,r)},{constant:e.constant&&n.constant&&i.constant})},binaryFn:function(e,n,i){return t(function(t,r){return n(t,r,e,i)},{constant:e.constant&&i.constant})},statements:function x(){for(var x=[];;)if(this.tokens.length>0&&!this.peek("}",")",";","]")&&x.push(this.filterChain()),!this.expect(";"))return 1===x.length?x[0]:function(e,t){for(var n,i=0;i<x.length;i++){var r=x[i];r&&(n=r(e,t))}return n}},filterChain:function(){for(var e,t=this.expression();;){if(!(e=this.expect("|")))return t;t=this.binaryFn(t,e.fn,this.filter())}},filter:function(){for(var e=this.expect(),t=this.$filter(e.text),n=[];;){if(!(e=this.expect(":"))){var i=function(e,i,r){for(var s=[r],a=0;a<n.length;a++)s.push(n[a](e,i));return t.apply(e,s)};return function(){return i}}n.push(this.expression())}},expression:function(){return this.assignment()},assignment:function(){var e,t,n=this.ternary();return(t=this.expect("="))?(n.assign||this.throwError("implies assignment but ["+this.text.substring(0,t.index)+"] can not be assigned to",t),e=this.ternary(),function(t,i){return n.assign(t,e(t,i),i)}):n},ternary:function(){var e,t,n=this.logicalOR();return(t=this.expect("?"))?(e=this.ternary(),(t=this.expect(":"))?this.ternaryFn(n,e,this.ternary()):void this.throwError("expected :",t)):n},logicalOR:function(){for(var e,t=this.logicalAND();;){if(!(e=this.expect("||")))return t;t=this.binaryFn(t,e.fn,this.logicalAND())}},logicalAND:function(){var e,t=this.equality();return(e=this.expect("&&"))&&(t=this.binaryFn(t,e.fn,this.logicalAND())),t},equality:function(){var e,t=this.relational();return(e=this.expect("==","!=","===","!=="))&&(t=this.binaryFn(t,e.fn,this.equality())),t},relational:function(){var e,t=this.additive();return(e=this.expect("<",">","<=",">="))&&(t=this.binaryFn(t,e.fn,this.relational())),t},additive:function(){for(var e,t=this.multiplicative();e=this.expect("+","-");)t=this.binaryFn(t,e.fn,this.multiplicative());return t},multiplicative:function(){for(var e,t=this.unary();e=this.expect("*","/","%");)t=this.binaryFn(t,e.fn,this.unary());return t},unary:function(){var e;return this.expect("+")?this.primary():(e=this.expect("-"))?this.binaryFn(g.ZERO,e.fn,this.unary()):(e=this.expect("!"))?this.unaryFn(e.fn,this.unary()):this.primary()},fieldAccess:function(e){var n=this,i=this.expect().text,r=p(i,this.options,this.text);return t(function(t,n,i){return r(i||e(t,n))},{assign:function(t,r,s){var a=e(t,s);return a||e.assign(t,a={},s),c(a,i,r,n.text,n.options)}})},objectIndex:function(e){var n=this,i=this.expression();return this.consume("]"),t(function(t,r){var s,a=e(t,r),o=i(t,r);if(a)return s=u(a[o],n.text)},{assign:function(t,r,s){var a=i(t,s),o=u(e(t,s),n.text);return o||e.assign(t,o=[],s),o[a]=r}})},functionCall:function(t,n){var i=[];if(")"!==this.peekToken().text)do i.push(this.expression());while(this.expect(","));this.consume(")");var r=this;return function(s,a){for(var o=[],c=n?n(s,a):s,l=0;l<i.length;l++)o.push(i[l](s,a));var h=t(s,a,c)||e;u(c,r.text),u(h,r.text);var f=h.apply?h.apply(c,o):h(o[0],o[1],o[2],o[3],o[4]);return u(f,r.text)}},arrayDeclaration:function(){var e=[],n=!0;if("]"!==this.peekToken().text)do{if(this.peek("]"))break;var i=this.expression();e.push(i),i.constant||(n=!1)}while(this.expect(","));return this.consume("]"),t(function(t,n){for(var i=[],r=0;r<e.length;r++)i.push(e[r](t,n));return i},{literal:!0,constant:n})},object:function(){var e=[],n=!0;if("}"!==this.peekToken().text)do{if(this.peek("}"))break;var i=this.expect(),r=i.string||i.text;this.consume(":");var s=this.expression();e.push({key:r,value:s}),s.constant||(n=!1)}while(this.expect(","));return this.consume("}"),t(function(t,n){for(var i={},r=0;r<e.length;r++){var s=e[r];i[s.key]=s.value(t,n)}return i},{literal:!0,constant:n})}};var k={};return v={Lexer:y,Parser:g}}),n.module("wires.expressions.AngularExpressions",["wires.expressions.AngularExpressionParser","utils.lodash"],function(e,t){function n(e){var t;if("string"!=typeof e)throw new TypeError("src must be a string, instead saw '"+("undefined"==typeof e?"undefined":_typeof(e))+"'");return n.cache?(t=n.cache[e],t||(t=n.cache[e]=l.parse(e)),t):l.parse(e)}function i(e){if("string"!=typeof e)throw new TypeError("src must be a string, instead saw '"+("undefined"==typeof e?"undefined":_typeof(e))+"'");var n,i=l.tokenize(e),r={},s=!1;for(var a in i){var o=i[a];t.isString(o.text)&&o.text.match(/[a-z0-9\.$]+/i)&&(s?n&&(o.string?n.str=o.string:(n.nested={},n.nested[o.text]={},n=n.nested[o.text]),s=!1):o.json||(n=r[o.text]={})),"["===o.text&&(s=!0)}return r}var r,s=e,a={},o=s.Lexer,u=s.Parser,c=new o({}),l=new u(c,function(e){return a[e]});return n.cache={},r={Lexer:o,Parser:u,extract:i,compile:n,filters:a}}),n.module("wires.expressions.StringInterpolation",["utils.lodash","wires.expressions.AngularExpressions","wires.expressions.WatchBatch","wires.utils.DotNotation"],function(e,t,n,i){var r,s={compile:function(i){return e.isArray(i)||(i=this.parse(i)),function(r,s,a,o){var u=r||{},c=a?s:{},l=arguments.length>=3?a:s,h=e.chain(i).map(function(e){return e.v||!1}).compact().value();if(0===h.length)return l(i.join(""));var f,p=function(){var n=e.map(i,function(e){return e.e?t.compile(e.e)(u,c):e}),r=n.join("");l(r,f),f=r};return o&&p(),n({locals:c,scope:u,batch:h},p)}},parse:function(n){if(!e.isString(n))return[];var i=/({{\s*[^}]+\s*}})/g,r=n.split(i).map(function(e){var n;if(n=e.match(/{{\s*([^}]+)\s*}}/)){var i=n[1].trim();return{e:i,v:t.extract(i)}}return e});return e.filter(r,function(e){return e?e:void 0})}};return r=s}),n.module("wires.expressions.WatchBatch",["utils.lodash","wires.AsyncWatch","wires.utils.DotNotation"],function(e,t,n){var i;return i=function(i,r){i=i||{};var s=i.locals||{},a=i.scope||{},o=i.batch?[].concat(i.batch):[],u=[];e.each(o,function(t){var n=e.keys(t)[0];t[n];u.push(n)});var c=function(e){},l=[];return e.each(u,function(e){n.hasProperty(s,e)?l.push(t(s,e,c)):l.push(t(a,e,c))}),l=e.compact(l),l.length&&r?t.subscribe(l,r):{}}}),n.module("wires.directives.Click",["wires.core.Directive"],function(e){var t,n=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){var t=e.asFunction(),n=this.element.scope;this.element.bindEvent("click",function(){t.bind(n)({event:event})})}}],[{key:"compiler",get:function(){return{name:"ng-click"}}}]),t}(e);return t=n}),n.module("wires.directives.Conditional",["wires.core.Directive"],function(e){var t,n=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){var t=this;this.element;this.$initialized=!1,e.watchExpression(function(e){e?t.createNodes():t.removeNodes()},!0)}},{key:"removeNodes",value:function(){this.clone&&this.clone.remove()}},{key:"createNodes",value:function(){this.clone=this.element.clone(),this.clone.schema.detachAttribute("ng-if"),this.clone.create(),this.clone.insertAfter(this.element),this.clone.initialize()}}],[{key:"compiler",get:function(){return{name:"ng-if",type:"attribute",attribute:{placeholder:!0}}}}]),t}(e);return t=n}),n.module("wires.directives.IncludeView",["wires.core.Directive","wires.runtime.Schema"],function(e,t){var n,i=function(e){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,e),_createClass(n,[{key:"initialize",value:function(e){var n=this;this.element;if(this.inflated=!1,this.isElementDirective=!1,e||(e=this.element.attrs.src,this.isElementDirective=!0),!e)throw"Directive needs either src attribute or self value!";e&&e.watchString(function(e){n.inflated&&n.element.removeChildren(),t[e]&&n.createSchema(t[e])},!0)}},{key:"createSchema",value:function(e){this.element.inflate(e)}}],[{key:"compiler",get:function(){return{name:"ng-include"}}}]),n}(e);return n=i}),n.module("wires.directives.Model",["wires.expressions.AngularExpressions","wires.core.Directive"],function(e,t){var n,i=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){var t=this.element.original,n="text",i=this.element.attrs.type;i&&(n=i.value[0]),"select"===t.nodeName.toLowerCase()&&(n="select"),e.watchExpression(function(e){"text"===n&&(t.value=e),"checkbox"===n&&(t.checked=e),"select"===n&&(t.value=e),"radio"===n&&e===t.value&&(t.checked=!0)}),"text"===n&&this.bindEvent("keyup",function(){e.assign(t.value)}),"checkbox"===n&&this.bindEvent("click",function(){e.assign(t.checked)}),"select"===n&&this.bindEvent("change",function(){e.assign(t.value)}),"radio"===n&&this.bindEvent("click",function(){e.assign(t.value)})}}],[{key:"compiler",get:function(){return{name:"ng-model"}}}]),t}(t);return n=i}),n.module("wires.directives.MyDirective",["wires.core.Directive"],function(e){var t,n=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){this.myName="This is my name"}}],[{key:"compiler",get:function(){return{name:"my-directive",schema:"other/my-directive.html"}}}]),t}(e);return t=n}),n.module("wires.directives.Show",["wires.core.Directive"],function(e){var t,n=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){var e=this,t=this.element,n=t.attrs["ng-show"];n.watchExpression(function(t,n,i){t?e.show():e.hide()},!0)}},{key:"hide",value:function(){this.element.hide()}},{key:"show",value:function(){this.element.show()}}],[{key:"compiler",get:function(){return{name:"ng-show"}}}]),t}(e);return t=n}),n.module("wires.directives.ToggleClass",["wires.core.Directive"],function(e){var t,n=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return _inherits(t,e),_createClass(t,null,[{key:"compiler",get:function(){return{name:"ng-class"}}}]),_createClass(t,[{key:"initialize",value:function(e,t){}}]),t}(e);return t=n}),n.module("wires.directives.Transclude",["wires.core.Directive"],function(e){var t,n=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){this.element.scope.$$transcluded&&(this.element.schema.children=this.element.scope.$$transcluded)}},{key:"hide",value:function(){this.element.hide()}},{key:"show",value:function(){this.element.show()}}],[{key:"compiler",get:function(){return{name:"ng-transclude"}}}]),t}(e);return t=n}),n.module("wires.directives.WsLink",["wires.core.Directive","wires.app.PushState"],function(e,t){var n,i=function(e){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,e),_createClass(n,[{key:"initialize",value:function(e){var n=this;this.element.bindEvent("click",function(e){e.preventDefault(),e.stopPropagation();var i=n.element.attr("href");t.force({},i)}),e.watchString(function(e){n.element.attr("href",e)},!0)}}],[{key:"compiler",get:function(){return{name:"ws-link"}}}]),n}(e);return n=i}),n.module("wires.directives.WsRoute",["wires.core.Directive"],function(e){var t,n=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(e){var t=this.element.scope,n=t.$$router;this.element.schema.children=[],n&&n.dispatcher&&n.dispatcher.register(this.element,t)}}],[{key:"compiler",get:function(){return{name:"ws-route"}}}]),t}(e);return t=n}),n.module("wires.core.Attribute",["wires.expressions.StringInterpolation","wires.expressions.AngularExpressions","wires.expressions.WatchBatch","wires.services.Watch","wires.core.Common"],function(e,t,n,i,r){var s,a=function(n){function r(e,t,n){_classCallCheck(this,r);var i=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return i.element=e,i.name=t,i.value=n,i.watchers=[],i.model,i}return _inherits(r,n),_createClass(r,[{key:"initialize",value:function(){if(!this.directive){var e=document.createAttribute(this.name);this.original=e,this.element.original.setAttributeNode(e);var t=this;this.registerWatcher(this.watchString(function(e){t.original.value=e}))}}},{key:"assign",value:function(e){this.model||(this.model=t.compile(this.value)),this.model.assign(this.element.scope,e)}},{key:"asFunction",value:function(){var e=t.compile(this.value),n=this.element.scope;return function(t){e(n,t)}}},{key:"watchExpression",value:function(e,t){var n=i({locals:this.element.locals,scope:this.element.scope},this.value,function(t,n,i){if(t!==n||void 0===n)return e(t,n,i)},t);this.registerWatcher(n)}},{key:"asString",value:function(t){var n=e.compile(this.value);return n(this.element.scope,this.element.locals);
}},{key:"watchString",value:function(t,n){var i=e.compile(this.value),r=i(this.element.scope,this.element.locals,function(e,n){if(e!==n||void 0===n)return t(e,n)},n);this.registerWatcher(r)}}]),r}(r);return s=a}),n.module("wires.core.Common",["utils.lodash"],function(e){var t,n=function(){function t(){_classCallCheck(this,t),this.__events=[]}return _createClass(t,[{key:"bindEvent",value:function(e,t){var n=this.element?this.element.original:this.original;n&&(n.addEventListener(e,t,!1),this.__events.push({name:e,cb:t}))}},{key:"__gc",value:function(){this.destroyWatchers(),this.destroyListeners()}},{key:"destroyListeners",value:function(){var t=this,n=this.element?this.element.original:this.original;n&&(e.each(this.__events,function(e,i){n.removeEventListener(e.name,e.cb),t.__events[i]=void 0}),this.__events={})}},{key:"registerWatcher",value:function(e){this.watchers=this.watchers||[],this.watchers.push(e)}},{key:"destroyWatchers",value:function(){e.each(this.watchers,function(e){e.destroy()})}}]),t}();return t=n}),n.module("wires.core.Directive",["wires.runtime.Schema","wires.utils.Properties","wires.core.Common"],function(e,t,n){var i,r=function(n){function i(e){_classCallCheck(this,i);var t=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return t.element=e,t}return _inherits(i,n),_createClass(i,[{key:"inflate",value:function(n){n=n||{};var i=n.transclude,r=n.locals||this.element.locals,s=n.scope||this;i&&t.defineHidden(s,"$$transcluded",i);var a=this.__proto__.constructor.compiler;if(a.schema&&e[a.schema]){var r=r||this.element.locals;this.element.inflate(e[a.schema],s,r)}}},{key:"detach",value:function(){this.__gc()}}]),i}(n);return i=r}),n.module("wires.core.Element",["wires.core.Attribute","wires.core.Common","utils.lodash","wires.expressions.StringInterpolation","wires.compiler.Packer","wires.runtime.Directives"],function(e,t,n,i,r,s){var a,o=function(t){function i(e,t,n){_classCallCheck(this,i);var r=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return r.scope=t,r.locals=n,r.children=[],r.schema=e,r.attrs={},r.directives={},r}return _inherits(i,t),_createClass(i,[{key:"create",value:function(e){this.filterAttrs();var t;return t=this.controllingDirective?document.createComment(""):document.createElement(this.schema.name),this.original=t,e&&this.inflate(e),t}},{key:"initialize",value:function(e){if(!this.schema)throw"Cannot initialize an element without schema!";if(this.controllingDirective){var t=this.controllingDirective.__proto__.constructor.compiler;this.controllingDirective.initialize(this.attrs[t.name])}else this.initAttrs(),this.initDirectives();this.controllingDirective||this.primaryDirective||this.schema.inflate({scope:this.scope,locals:this.locals,schema:this.schema.children,target:this}),this.primaryDirective&&this.primaryDirective.inflate({transclude:this.schema.children})}},{key:"initAttrs",value:function(){n.each(this.attrs,function(e,t){e.initialize()})}},{key:"setPrimaryDirective",value:function(e,t){this.directives[e]=t,this.primaryDirective=t}},{key:"initDirectives",value:function(){var e=this;n.each(this.directives,function(t,n){t.initialize(e.attrs[n])})}},{key:"filterAttrs",value:function(){var t=this;n.each(t.schema.attrs,function(n){var i=new e(t,n.name,n.value);if(n.requires){var r=s[n.requires],a=r.compiler;if(a.attribute&&a.attribute.placeholder)t.controllingDirective=new r(t),i.directive=t.controllingDirective;else{var o=new r(t);t.directives[n.name]=o,i.directive=o}}t.attrs[n.name]=i})}},{key:"inflate",value:function(e,t,n){this.schema.inflate({target:this,schema:e||this.schema.children,scope:t||this.scope,locals:n||this.locals})}},{key:"remove",value:function(){this.detach(),this.original&&this.original.parentNode&&this.original.parentNode.removeChild(this.original),this.children=[],this.directives=[]}},{key:"detach",value:function(){this.__gc(),n.each(this.children,function(e){e.detach()}),n.each(this.directives,function(e){e.detach()})}},{key:"clone",value:function(e,t){return this.schema.init(this.schema.clone(),e||this.scope,t||this.locals)}},{key:"newInstance",value:function(e,t,n){return new i(e,t,n)}},{key:"setControllingDirective",value:function(e){this.controllingDirective=e}},{key:"removeChildren",value:function(){n.each(this.children,function(e){e.remove()})}},{key:"append",value:function(e){this.children.push(e),this.controllingDirective||this.original.appendChild(e.original)}},{key:"appendTo",value:function(e){e instanceof window.Element?e.appendChild(this.original):e.append(this)}},{key:"detachElement",value:function(){this.original&&this.original.parentNode&&this.original.parentNode.removeChild(this.original)}},{key:"attachElement",value:function(){this.original&&this.original.parentNode&&this.original.parentNode.appendChild(this.original)}},{key:"insertAfter",value:function(e){e.original.parentNode.insertBefore(this.original,e.original.nextSibling)}},{key:"setChildren",value:function(e){this.children=e}},{key:"attr",value:function(e,t){return void 0===t?this.original.getAttribute(e):void this.original.setAttribute(e,t)}},{key:"hide",value:function(){this.original.style.display="none"}},{key:"show",value:function(){this.original.style.display=""}}]),i}(t);return a=o}),n.module("wires.core.Schema",["wires.compiler.Packer","utils.lodash","wires.core.Element","wires.core.TextNode","wires.runtime.Directives","wires.runtime.Schema"],function(e,t,n,i,r,s){var a,o=function(){function s(n){if(_classCallCheck(this,s),this.json=n,n){var i=e.unpack(n),r=this;t.each(i,function(e,t){r[t]=e})}}return _createClass(s,[{key:"detachAttribute",value:function(e){t.remove(this.attrs,function(t){return t.name===e})}},{key:"inflate",value:function(e){return s.inflate(e)}},{key:"init",value:function(e,t,n){return s.init(e,t,n)}},{key:"clone",value:function(){return new s(this.json)}}],[{key:"init",value:function(e,t,r){var a;return"tag"===e.type&&(a=new n(e,t,r)),"directive"===e.type&&(a=s.createDirectiveElement(e,t,r)),"text"===e.type&&(a=new i(e,t,r)),a}},{key:"createDirectiveElement",value:function(e,t,i){var s,a=r[e.requires];if(a){var o=a.compiler||{},u=new a;o.element&&o.element.placeholder?(s=new n(e,t,i),u.element=s,s.setControllingDirective(u)):(s=new n(e,t,i),u.element=s,s.setPrimaryDirective(e.name,u))}return s}},{key:"inflate",value:function(e){e=e||{};var n=e.scope,i=e.locals,r=e.target,a=e.schema;t.each(a,function(e){var t=new s(e),a=s.init(t,n,i);a&&(a.create(),a.appendTo(r),a.initialize())})}}]),s}();return a=o}),n.module("wires.core.TextNode",["wires.expressions.StringInterpolation","wires.core.Common"],function(e,t){var n,i=function(t){function n(e,t,i){_classCallCheck(this,n);var r=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r.schema=e,r.scope=t,r.locals=i,r}return _inherits(n,t),_createClass(n,[{key:"create",value:function(){return this.original=document.createTextNode(""),this.original}},{key:"initialize",value:function(){var t=this,n=e.compile(this.schema.text);n(this.scope,this.locals,function(e){t.original.nodeValue=e},!0)}},{key:"insertAfter",value:function(e){e.original.parentNode.insertBefore(this.original,e.original.nextSibling)}},{key:"appendTo",value:function(e){e instanceof window.Element?e.appendChild(this.original):e.append(this)}},{key:"remove",value:function(){this.original&&this.original.parentNode&&this.original.parentNode.removeChild(this.original),this.detach()}},{key:"detach",value:function(){return this.destroyWatchers()}}]),n}(t);return n=i}),n.module("wires.compiler.JSONifier",["realm","utils.lodash","wires.expressions.StringInterpolation","wires.compiler.Packer","wires.runtime.Directives","wires.htmlparser.Parser"],function(e,t,n,i,r,s){var a,o=function(){function e(t,n){_classCallCheck(this,e),this.directives=t,this.elements=n,this.json=[]}return _createClass(e,[{key:"getResult",value:function(){return this.iterateChildren(this.elements)}},{key:"createTag",value:function(e){var r={},s=this,a=e.name,o=this.directives[a],u=e.children,c={};return t.each(e.attrs,function(e,t){var i=s.directives[t];c[t]={},i?(c[t].value=e,c[t].requires=i.path):c[t]={value:n.parse(e)}}),r.attrs=c,r.type="tag",o?(r.type="directive",r.name=a,r.requires=o.path):r.name=a,r.children=u&&u.length?this.iterateChildren(u):[],i.pack(r)}},{key:"createText",value:function(e){var t=e.value;if(t&&!t.match(/^\s*$/g))return i.pack({type:"text",text:n.parse(t)})}},{key:"iterateChildren",value:function(e){var n=[],i=this;return t.each(e,function(e){var t="tag"===e.type,r="text"===e.type;if(t&&n.push(i.createTag(e)),r){var s=i.createText(e);s&&n.push(s)}}),n}}],[{key:"htmlString",value:function(n){var i={};t.each(r,function(e,t){i[e.compiler.name]={opts:e.compiler,cls:e,path:t}});var a=s.parse(n,!0),o=new e(i,a),u=o.getResult();return u}}]),e}();return a=o}),n.module("wires.compiler.Packer",["utils.lodash"],function(e){var t,n=function(){function t(n){_classCallCheck(this,t),this.types=n,this.inverted=e.invert(n)}return _createClass(t,[{key:"pack",value:function(e){return this.types[e]||0}},{key:"unpack",value:function(e){return this.inverted[e]}}]),t}(),i=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{tag:0,text:1,directive:2,include:3}))}return _inherits(t,e),t}(n),r=new i,s=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"pack",value:function(t){t=t||{};var n=t.type,i=t.name,s=t.requires,a=[],o=t.children||[];if(e.each(t.attrs,function(e,t){var n=[t,e.value];e.requires&&n.push(e.requires),a.push(n)}),"text"===n)return[r.pack(n),t.text];var u=[r.pack(n),s||0,i,a];return o&&u.push(o),u}},{key:"unpack",value:function(t){var n=r.unpack(t[0]);if("text"===n)return{type:"text",text:t[1]};var i=t[3],s=[];e.each(i,function(e){var t={name:e[0],value:e[1]};e[2]&&(t.requires=e[2]),s.push(t)});var a={type:n,name:t[2],attrs:s,children:t[4]||[]};return t[1]&&(a.requires=t[1]),a}}]),t}();return t=s}),n.module("wires.compiler.SchemaGenerator",["nodejs.utils.fs","nodejs.utils.walk","nodejs.utils.path","nodejs.utils.stream","wires.compiler.JSONifier","utils.lodash","utils.Promise","realm"],function(e,t,n,i,r,s,a,o){var u,c=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"service",value:function(e,t){return i.walkDirectory(e).then(function(e){var n=['realm.module("'+(t||"wires.schema.sample")+'", function(){'];n.push("\n\treturn {\n");var i=[];return s.each(e,function(e,t){i.push('\t  "'+t+'":'+JSON.stringify(e))}),n.push(i.join(",\n")),n.push("\n\t}\n});"),n.join("")})}},{key:"compact",value:function(e,t){return new a(function(t,n){console.log(e),i.collectWiresSchemas(e).then(function(e){return console.log("FILES",e),t()})["catch"](function(e){console.log("eror",e)})})}},{key:"express",value:function(e,t){return function(n,r,s){i.getJavascript(e,t).then(function(e){return r.setHeader("content-type","text/javascript"),r.end(e)})}}},{key:"getJavascript",value:function(e,t){return i.service(e,t).then(function(e){return o.transpiler2.wrapContents(e)})}},{key:"walkDirectory",value:function(i){return new a(function(s,a){var o=t.walk(i),u={};o.on("file",function(t,s,a){var o=n.join(t,s.name),c=e.readFileSync(o).toString(),l=o.split(i)[1];u[l]=r.htmlString(c),a()}),o.on("end",function(){return s(u)})})}},{key:"collectWiresSchemas",value:function(i){return new a(function(s,a){var o=t.walk(i),u={};o.on("file",function(t,s,a){if(s.name.match(/\.html$/)){var o=n.join(t,s.name),c=e.readFileSync(o).toString(),l=o.split(i)[1];u[l]=r.htmlString(c)}a()}),o.on("end",function(){return s(u)})})}}]),i}();return u=c}),n.module("wires.app.Dispatcher",["wires.core.Schema","wires.runtime.Schema","utils.lodash","wires.app.PushState"],function(e,t,n,i){var r,s,a=function(e){return"on"+e[0].toUpperCase()+e.slice(1,e.length)},o=function(){function r(){_classCallCheck(this,r);var e=this;this.states={},this.urls=[],i.subscribe(function(){e.changed()})}return _createClass(r,[{key:"storeEssentials",value:function(e,t){return e.$$router?(n.each(t,function(t,n){e.$$router[n]=t}),e.$$router):(Object.defineProperty(e,"$$router",{enumerable:!1,value:t}),e.$$router)}},{key:"assign",value:function(e){s||(s=e),this.changed()}},{key:"getEssentials",value:function(e){return e.$$router||{}}},{key:"getPaths",value:function(){var e=window.location.pathname;return e.split("/")}},{key:"getFullURL",value:function(){return window.location.href}},{key:"register",value:function(e,t){var i=this,r=i.storeEssentials(t,{element:e}),s=r.index+1,o=this.paths[r.index+1];if(e.removeChildren(),o){var u=t[a(o)];if(n.isFunction(u)){var c=this.evaluate(t,u);if(c.schema)return e.inflate(c.schema);if(c.instance){var l=i.initializeRoute(c.instance,s);return e.inflate(l.schema,c.instance)}}}}},{key:"changed",value:function(){var e=this;if(this.paths=this.getPaths(),!this.root)return e.urls=this.paths,this.createRoot();var t;if(n.each(this.paths,function(n,i){e.urls[i]!==n&&void 0===t&&(t=i)}),void 0===t&&e.paths.length!==e.urls.length&&(t=n.findLastIndex(this.paths)),t>-1){var i=e.states[t-1];void 0!==i&&i.$$router&&e.register(i.$$router.element,i)}e.fullURL=e.getFullURL(),e.urls=this.paths}},{key:"initializeRoute",value:function(e,t){var n=this;return n.storeEssentials(e,{index:t,dispatcher:n}),n.states[t]=e,this.evaluate(e,e.initialize)}},{key:"createRoot",value:function(){var t=this;this.root=new s,t.storeEssentials(this.root,{index:0,dispatcher:t}),t.states[0]=this.root;var n=this.evaluate(this.root,this.root.initialize);n.schema&&e.inflate({schema:n.schema,target:document.querySelector("body"),scope:t.root})}},{key:"evaluate",value:function(e,i){var r=(e.$$router.index,i.apply(e));console.log(r);if(n.isString(r)){if(!t[r])throw{message:r+" is not found in schemas!"};return{type:"schema",schema:t[r]}}return{type:"route",instance:r}}}]),r}(),u=new o;return r=u}),n.module("wires.app.PushState",["wires.app.Query","utils.lodash"],function(e,n){var i,r=[],s=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"_createQueryString",value:function(e){var t=[];n.each(e,function(e,n){t.push(n+"="+encodeURI(e))});var i=t.join("&");return t.length>0&&(i="?"+i),i}},{key:"subscribe",value:function(e){r.push(e)}},{key:"changed",value:function(){n.each(r,function(e){e()})}},{key:"redirect",value:function(e){History.set(e)}},{key:"get",value:function(t){var n=e.get();return t?n[t]:n}},{key:"_changeState",value:function(e){var n={url:e};history.pushState(n,e,e),t.changed()}},{key:"force",value:function(e,t){this._changeState((t||window.location.pathname)+this._createQueryString(e))}},{key:"merge",value:function(t,i){if(n.isPlainObject(t)){var r=e.get(),s=n.merge(r,t),a=(i||window.location.pathname)+this._createQueryString(s);this._changeState(a)}}}]),t}(),a=t?{}:window;return a.onpopstate=function(e){s.changed()},i=s}),n.module("wires.app.Query",[],function(){var e,t=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"get",value:function(){for(var e={},t=window.location.search.substring(1),n=t.split("&"),i=0;i<n.length;i++){var r=n[i].split("=");if("undefined"==typeof e[r[0]])r[0]&&(e[r[0]]=decodeURIComponent(r[1]));else if("string"==typeof e[r[0]]){var s=[e[r[0]],decodeURIComponent(r[1])];e[r[0]]=s}else e[r[0]].push(decodeURIComponent(r[1]))}return e}}]),e}();return e=t}),n.module("wires.app.Router",["wires.app.Dispatcher","utils.lodash"],function(e,t){var n,i=function(){function n(){_classCallCheck(this,n)}return _createClass(n,[{key:"render",value:function(e){return t.isString(e)?{type:"schema",path:e}:e instanceof n?{type:"router",instance:e}:void 0}}],[{key:"start",value:function(){e.assign(this)}}]),n}();return n=i}),n.module("wires.app.render",[],function(){var e,t=function(e,t){};return e=t})}(function(e){var t="undefined"!=typeof exports;return{isNode:t,realm:t?require("realm-js"):window.realm}}());