!function(){function a(){return"function"==typeof require&&"object"==typeof exports&&"object"==typeof module&&"string"==typeof __filename&&"string"==typeof __dirname}function b(a,b){this._options=b?b:{},void 0==this._options.includeLocation&&(this._options.includeLocation=!1),this.validateHandler(a),this._handler=a,this.reset()}function c(a){c.super_.call(this,a,{ignoreWhitespace:!0,verbose:!1,enforceEmptyTags:!1})}function d(a,b){this.reset(),this._options=b?b:{},void 0==this._options.ignoreWhitespace&&(this._options.ignoreWhitespace=!1),void 0==this._options.verbose&&(this._options.verbose=!0),void 0==this._options.enforceEmptyTags&&(this._options.enforceEmptyTags=!0),"function"==typeof a&&(this._callback=a)}function e(a,b){var c=function(){};c.prototype=b.prototype,a.super_=b,a.prototype=new c,a.prototype.constructor=a}if(!a()){if(this.Tautologistics){if(this.Tautologistics.NodeHtmlParser)return}else this.Tautologistics={};this.Tautologistics.NodeHtmlParser={},exports=this.Tautologistics.NodeHtmlParser}var f={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag"};b._reTrim=/(^\s+|\s+$)/g,b._reTrimComment=/(^\!--|--$)/g,b._reWhitespace=/\s/g,b._reTagName=/^\s*(\/?)\s*([^\s\/]+)/,b._reAttrib=/([^=<>\"\'\s]+)\s*=\s*"([^"]*)"|([^=<>\"\'\s]+)\s*=\s*'([^']*)'|([^=<>\"\'\s]+)\s*=\s*([^'"\s]+)|([^=<>\"\'\s\/]+)/g,b._reTags=/[\<\>]/g,b.prototype.parseComplete=function(a){this.reset(),this.parseChunk(a),this.done()},b.prototype.parseChunk=function(a){this._done&&this.handleError(new Error("Attempted to parse chunk after parsing already done")),this._buffer+=a,this.parseTags()},b.prototype.done=function(){if(!this._done){if(this._done=!0,this._buffer.length){var a=this._buffer;this._buffer="";var c={raw:a,data:this._parseState==f.Text?a:a.replace(b._reTrim,""),type:this._parseState};(this._parseState==f.Tag||this._parseState==f.Script||this._parseState==f.Style)&&(c.name=this.parseTagName(c.data)),this.parseAttribs(c),this._elements.push(c)}this.writeHandler(),this._handler.done()}},b.prototype.reset=function(){this._buffer="",this._done=!1,this._elements=[],this._elementsCurrent=0,this._current=0,this._next=0,this._location={row:0,col:0,charOffset:0,inBuffer:0},this._parseState=f.Text,this._prevTagSep="",this._tagStack=[],this._handler.reset()},b.prototype._options=null,b.prototype._handler=null,b.prototype._buffer=null,b.prototype._done=!1,b.prototype._elements=null,b.prototype._elementsCurrent=0,b.prototype._current=0,b.prototype._next=0,b.prototype._location=null,b.prototype._parseState=f.Text,b.prototype._prevTagSep="",b.prototype._tagStack=null,b.prototype.parseTagAttribs=function(a){for(var b=a.length,c=0;b>c;){var d=a[c++];(d.type==f.Tag||d.type==f.Script||d.type==f.style)&&this.parseAttribs(d)}return a},b.prototype.parseAttribs=function(a){if(a.type==f.Script||a.type==f.Style||a.type==f.Tag){var c=a.data.split(b._reWhitespace,1)[0],d=a.data.substring(c.length);if(!(d.length<1)){var e;for(b._reAttrib.lastIndex=0;e=b._reAttrib.exec(d);)void 0==a.attribs&&(a.attribs={}),"string"==typeof e[1]&&e[1].length?a.attribs[e[1]]=e[2]:"string"==typeof e[3]&&e[3].length?a.attribs[e[3].toString()]=e[4].toString():"string"==typeof e[5]&&e[5].length?a.attribs[e[5]]=e[6]:"string"==typeof e[7]&&e[7].length&&(a.attribs[e[7]]=e[7])}}},b.prototype.parseTagName=function(a){if(null==a||""==a)return"";var c=b._reTagName.exec(a);return c?(c[1]?"/":"")+c[2]:""},b.prototype.parseTags=function(){for(var a=this._buffer.length-1;b._reTags.test(this._buffer);){this._next=b._reTags.lastIndex-1;var c=this._buffer.charAt(this._next),d=this._buffer.substring(this._current,this._next),e={raw:d,data:this._parseState==f.Text?d:d.replace(b._reTrim,""),type:this._parseState},g=this.parseTagName(e.data);if(this._tagStack.length)if(this._tagStack[this._tagStack.length-1]==f.Script){if("/script"==g.toLowerCase())this._tagStack.pop();else if(0!=e.raw.indexOf("!--")&&(e.type=f.Text,this._elements.length&&this._elements[this._elements.length-1].type==f.Text)){var h=this._elements[this._elements.length-1];h.raw=h.data=h.raw+this._prevTagSep+e.raw,e.raw=e.data=""}}else if(this._tagStack[this._tagStack.length-1]==f.Style){if("/style"==g.toLowerCase())this._tagStack.pop();else if(0!=e.raw.indexOf("!--"))if(e.type=f.Text,this._elements.length&&this._elements[this._elements.length-1].type==f.Text){var h=this._elements[this._elements.length-1];""!=e.raw?(h.raw=h.data=h.raw+this._prevTagSep+e.raw,e.raw=e.data=""):h.raw=h.data=h.raw+this._prevTagSep}else""!=e.raw&&(e.raw=e.data=e.raw)}else if(this._tagStack[this._tagStack.length-1]==f.Comment){var i=e.raw.length;if("-"==e.raw.charAt(i-2)&&"-"==e.raw.charAt(i-1)&&">"==c)if(this._tagStack.pop(),this._elements.length&&this._elements[this._elements.length-1].type==f.Comment){var h=this._elements[this._elements.length-1];h.raw=h.data=(h.raw+e.raw).replace(b._reTrimComment,""),e.raw=e.data="",e.type=f.Text}else e.type=f.Comment;else if(e.type=f.Comment,this._elements.length&&this._elements[this._elements.length-1].type==f.Comment){var h=this._elements[this._elements.length-1];h.raw=h.data=h.raw+e.raw+c,e.raw=e.data="",e.type=f.Text}else e.raw=e.data=e.raw+c}if(e.type==f.Tag){e.name=g;var j=g.toLowerCase();if(0==e.raw.indexOf("!--")){e.type=f.Comment,delete e.name;var i=e.raw.length;"-"==e.raw.charAt(i-1)&&"-"==e.raw.charAt(i-2)&&">"==c?e.raw=e.data=e.raw.replace(b._reTrimComment,""):(e.raw+=c,this._tagStack.push(f.Comment))}else 0==e.raw.indexOf("!")||0==e.raw.indexOf("?")?e.type=f.Directive:"script"==j?(e.type=f.Script,"/"!=e.data.charAt(e.data.length-1)&&this._tagStack.push(f.Script)):"/script"==j?e.type=f.Script:"style"==j?(e.type=f.Style,"/"!=e.data.charAt(e.data.length-1)&&this._tagStack.push(f.Style)):"/style"==j&&(e.type=f.Style);e.name&&"/"==e.name.charAt(0)&&(e.data=e.name)}(""!=e.raw||e.type!=f.Text)&&(this._options.includeLocation&&!e.location&&(e.location=this.getLocation(e.type==f.Tag)),this.parseAttribs(e),this._elements.push(e),e.type!=f.Text&&e.type!=f.Comment&&e.type!=f.Directive&&"/"==e.data.charAt(e.data.length-1)&&this._elements.push({raw:"/"+e.name,data:"/"+e.name,name:"/"+e.name,type:e.type})),this._parseState="<"==c?f.Tag:f.Text,this._current=this._next+1,this._prevTagSep=c}this._options.includeLocation&&(this.getLocation(),this._location.row+=this._location.inBuffer,this._location.inBuffer=0,this._location.charOffset=0),this._buffer=this._current<=a?this._buffer.substring(this._current):"",this._current=0,this.writeHandler()},b.prototype.getLocation=function(a){for(var b,c=this._location,d=this._current-(a?1:0),e=a&&0==c.charOffset&&0==this._current;c.charOffset<d;c.charOffset++)b=this._buffer.charAt(c.charOffset),"\n"==b?(c.inBuffer++,c.col=0):"\r"!=b&&c.col++;return{line:c.row+c.inBuffer+1,col:c.col+(e?0:1)}},b.prototype.validateHandler=function(a){if("object"!=typeof a)throw new Error("Handler is not an object");if("function"!=typeof a.reset)throw new Error("Handler method 'reset' is invalid");if("function"!=typeof a.done)throw new Error("Handler method 'done' is invalid");if("function"!=typeof a.writeTag)throw new Error("Handler method 'writeTag' is invalid");if("function"!=typeof a.writeText)throw new Error("Handler method 'writeText' is invalid");if("function"!=typeof a.writeComment)throw new Error("Handler method 'writeComment' is invalid");if("function"!=typeof a.writeDirective)throw new Error("Handler method 'writeDirective' is invalid")},b.prototype.writeHandler=function(a){if(a=!!a,!this._tagStack.length||a)for(;this._elements.length;){var b=this._elements.shift();switch(b.type){case f.Comment:this._handler.writeComment(b);break;case f.Directive:this._handler.writeDirective(b);break;case f.Text:this._handler.writeText(b);break;default:this._handler.writeTag(b)}}},b.prototype.handleError=function(a){if("function"!=typeof this._handler.error)throw a;this._handler.error(a)},e(c,d),c.prototype.done=function(){var a,b={},d=g.getElementsByTagName(function(a){return"rss"==a||"feed"==a},this.dom,!1);if(d.length&&(a=d[0]),a){if("rss"==a.name){b.type="rss",a=a.children[0],b.id="";try{b.title=g.getElementsByTagName("title",a.children,!1)[0].children[0].data}catch(e){}try{b.link=g.getElementsByTagName("link",a.children,!1)[0].children[0].data}catch(e){}try{b.description=g.getElementsByTagName("description",a.children,!1)[0].children[0].data}catch(e){}try{b.updated=new Date(g.getElementsByTagName("lastBuildDate",a.children,!1)[0].children[0].data)}catch(e){}try{b.author=g.getElementsByTagName("managingEditor",a.children,!1)[0].children[0].data}catch(e){}b.items=[],g.getElementsByTagName("item",a.children).forEach(function(a){var c={};try{c.id=g.getElementsByTagName("guid",a.children,!1)[0].children[0].data}catch(d){}try{c.title=g.getElementsByTagName("title",a.children,!1)[0].children[0].data}catch(d){}try{c.link=g.getElementsByTagName("link",a.children,!1)[0].children[0].data}catch(d){}try{c.description=g.getElementsByTagName("description",a.children,!1)[0].children[0].data}catch(d){}try{c.pubDate=new Date(g.getElementsByTagName("pubDate",a.children,!1)[0].children[0].data)}catch(d){}b.items.push(c)})}else{b.type="atom";try{b.id=g.getElementsByTagName("id",a.children,!1)[0].children[0].data}catch(e){}try{b.title=g.getElementsByTagName("title",a.children,!1)[0].children[0].data}catch(e){}try{b.link=g.getElementsByTagName("link",a.children,!1)[0].attribs.href}catch(e){}try{b.description=g.getElementsByTagName("subtitle",a.children,!1)[0].children[0].data}catch(e){}try{b.updated=new Date(g.getElementsByTagName("updated",a.children,!1)[0].children[0].data)}catch(e){}try{b.author=g.getElementsByTagName("email",a.children,!0)[0].children[0].data}catch(e){}b.items=[],g.getElementsByTagName("entry",a.children).forEach(function(a){var c={};try{c.id=g.getElementsByTagName("id",a.children,!1)[0].children[0].data}catch(d){}try{c.title=g.getElementsByTagName("title",a.children,!1)[0].children[0].data}catch(d){}try{c.link=g.getElementsByTagName("link",a.children,!1)[0].attribs.href}catch(d){}try{c.description=g.getElementsByTagName("summary",a.children,!1)[0].children[0].data}catch(d){}try{c.pubDate=new Date(g.getElementsByTagName("updated",a.children,!1)[0].children[0].data)}catch(d){}b.items.push(c)})}this.dom=b}c.super_.prototype.done.call(this)},d._emptyTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1},d.reWhitespace=/^\s*$/,d.prototype.dom=null,d.prototype.reset=function(){this.dom=[],this._done=!1,this._tagStack=[],this._tagStack.last=function(){return this.length?this[this.length-1]:null}},d.prototype.done=function(){this._done=!0,this.handleCallback(null)},d.prototype.writeTag=function(a){this.handleElement(a)},d.prototype.writeText=function(a){this._options.ignoreWhitespace&&d.reWhitespace.test(a.data)||this.handleElement(a)},d.prototype.writeComment=function(a){this.handleElement(a)},d.prototype.writeDirective=function(a){this.handleElement(a)},d.prototype.error=function(a){this.handleCallback(a)},d.prototype._options=null,d.prototype._callback=null,d.prototype._done=!1,d.prototype._tagStack=null,d.prototype.handleCallback=function(a){if("function"==typeof this._callback)this._callback(a,this.dom);else if(a)throw a},d.prototype.isEmptyTag=function(a){var b=a.name.toLowerCase();return"/"==b.charAt(0)&&(b=b.substring(1)),this._options.enforceEmptyTags&&!!d._emptyTags[b]},d.prototype.handleElement=function(a){if(this._done&&this.handleCallback(new Error("Writing to the handler after done() called is not allowed without a reset()")),this._options.verbose||(delete a.raw,("tag"==a.type||"script"==a.type||"style"==a.type)&&delete a.data),this._tagStack.last())if(a.type!=f.Text&&a.type!=f.Comment&&a.type!=f.Directive)if("/"==a.name.charAt(0)){var b=a.name.substring(1);if(!this.isEmptyTag(a)){for(var c=this._tagStack.length-1;c>-1&&this._tagStack[c--].name!=b;);if(c>-1||this._tagStack[0].name==b)for(;c<this._tagStack.length-1;)this._tagStack.pop()}}else this._tagStack.last().children||(this._tagStack.last().children=[]),this._tagStack.last().children.push(a),this.isEmptyTag(a)||this._tagStack.push(a);else this._tagStack.last().children||(this._tagStack.last().children=[]),this._tagStack.last().children.push(a);else a.type!=f.Text&&a.type!=f.Comment&&a.type!=f.Directive?"/"!=a.name.charAt(0)&&(this.dom.push(a),this.isEmptyTag(a)||this._tagStack.push(a)):this.dom.push(a)};var g={testElement:function(a,b){if(!b)return!1;for(var c in a)if("tag_name"==c){if("tag"!=b.type&&"script"!=b.type&&"style"!=b.type)return!1;if(!a.tag_name(b.name))return!1}else if("tag_type"==c){if(!a.tag_type(b.type))return!1}else if("tag_contains"==c){if("text"!=b.type&&"comment"!=b.type&&"directive"!=b.type)return!1;if(!a.tag_contains(b.data))return!1}else if(!b.attribs||!a[c](b.attribs[c]))return!1;return!0},getElements:function(a,b,c,d){function e(a){return function(b){return b==a}}if(c=void 0===c||null===c||!!c,d=isNaN(parseInt(d))?-1:parseInt(d),!b)return[];var f,h=[];for(var i in a)"function"!=typeof a[i]&&(a[i]=e(a[i]));if(g.testElement(a,b)&&h.push(b),d>=0&&h.length>=d)return h;if(c&&b.children)f=b.children;else{if(!(b instanceof Array))return h;f=b}for(var j=0;j<f.length&&(h=h.concat(g.getElements(a,f[j],c,d)),!(d>=0&&h.length>=d));j++);return h},getElementById:function(a,b,c){var d=g.getElements({id:a},b,c,1);return d.length?d[0]:null},getElementsByTagName:function(a,b,c,d){return g.getElements({tag_name:a},b,c,d)},getElementsByTagType:function(a,b,c,d){return g.getElements({tag_type:a},b,c,d)}};exports.Parser=b,exports.DefaultHandler=d,exports.RssHandler=c,exports.ElementType=f,exports.DomUtils=g}(),function(){function a(a){var c=!1;return function(){if(c)throw new Error("Callback was already called.");c=!0,a.apply(b,arguments)}}var b,c,d={};b=this,null!=b&&(c=b.async),d.noConflict=function(){return b.async=c,d};var e=Object.prototype.toString,f=Array.isArray||function(a){return"[object Array]"===e.call(a)},g=function(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c+=1)b(a[c],c,a)},h=function(a,b){if(a.map)return a.map(b);var c=[];return g(a,function(a,d,e){c.push(b(a,d,e))}),c},i=function(a,b,c){return a.reduce?a.reduce(b,c):(g(a,function(a,d,e){c=b(c,a,d,e)}),c)},j=function(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b};"undefined"!=typeof process&&process.nextTick?(d.nextTick=process.nextTick,d.setImmediate="undefined"!=typeof setImmediate?function(a){setImmediate(a)}:d.nextTick):"function"==typeof setImmediate?(d.nextTick=function(a){setImmediate(a)},d.setImmediate=d.nextTick):(d.nextTick=function(a){setTimeout(a,0)},d.setImmediate=d.nextTick),d.each=function(b,c,d){function e(a){a?(d(a),d=function(){}):(f+=1,f>=b.length&&d())}if(d=d||function(){},!b.length)return d();var f=0;g(b,function(b){c(b,a(e))})},d.forEach=d.each,d.eachSeries=function(a,b,c){if(c=c||function(){},!a.length)return c();var d=0,e=function(){b(a[d],function(b){b?(c(b),c=function(){}):(d+=1,d>=a.length?c():e())})};e()},d.forEachSeries=d.eachSeries,d.eachLimit=function(a,b,c,d){var e=k(b);e.apply(null,[a,c,d])},d.forEachLimit=d.eachLimit;var k=function(a){return function(b,c,d){if(d=d||function(){},!b.length||0>=a)return d();var e=0,f=0,g=0;!function h(){if(e>=b.length)return d();for(;a>g&&f<b.length;)f+=1,g+=1,c(b[f-1],function(a){a?(d(a),d=function(){}):(e+=1,g-=1,e>=b.length?d():h())})}()}},l=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[d.each].concat(b))}},m=function(a,b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[k(a)].concat(c))}},n=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[d.eachSeries].concat(b))}},o=function(a,b,c,d){if(b=h(b,function(a,b){return{index:b,value:a}}),d){var e=[];a(b,function(a,b){c(a.value,function(c,d){e[a.index]=d,b(c)})},function(a){d(a,e)})}else a(b,function(a,b){c(a.value,function(a){b(a)})})};d.map=l(o),d.mapSeries=n(o),d.mapLimit=function(a,b,c,d){return p(b)(a,c,d)};var p=function(a){return m(a,o)};d.reduce=function(a,b,c,e){d.eachSeries(a,function(a,d){c(b,a,function(a,c){b=c,d(a)})},function(a){e(a,b)})},d.inject=d.reduce,d.foldl=d.reduce,d.reduceRight=function(a,b,c,e){var f=h(a,function(a){return a}).reverse();d.reduce(f,b,c,e)},d.foldr=d.reduceRight;var q=function(a,b,c,d){var e=[];b=h(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c&&e.push(a),b()})},function(){d(h(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};d.filter=l(q),d.filterSeries=n(q),d.select=d.filter,d.selectSeries=d.filterSeries;var r=function(a,b,c,d){var e=[];b=h(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c||e.push(a),b()})},function(){d(h(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};d.reject=l(r),d.rejectSeries=n(r);var s=function(a,b,c,d){a(b,function(a,b){c(a,function(c){c?(d(a),d=function(){}):b()})},function(){d()})};d.detect=l(s),d.detectSeries=n(s),d.some=function(a,b,c){d.each(a,function(a,d){b(a,function(a){a&&(c(!0),c=function(){}),d()})},function(){c(!1)})},d.any=d.some,d.every=function(a,b,c){d.each(a,function(a,d){b(a,function(a){a||(c(!1),c=function(){}),d()})},function(){c(!0)})},d.all=d.every,d.sortBy=function(a,b,c){d.map(a,function(a,c){b(a,function(b,d){b?c(b):c(null,{value:a,criteria:d})})},function(a,b){if(a)return c(a);var d=function(a,b){var c=a.criteria,d=b.criteria;return d>c?-1:c>d?1:0};c(null,h(b.sort(d),function(a){return a.value}))})},d.auto=function(a,b){b=b||function(){};var c=j(a),e=c.length;if(!e)return b();var h={},k=[],l=function(a){k.unshift(a)},m=function(a){for(var b=0;b<k.length;b+=1)if(k[b]===a)return void k.splice(b,1)},n=function(){e--,g(k.slice(0),function(a){a()})};l(function(){if(!e){var a=b;b=function(){},a(null,h)}}),g(c,function(c){var e=f(a[c])?a[c]:[a[c]],k=function(a){var e=Array.prototype.slice.call(arguments,1);if(e.length<=1&&(e=e[0]),a){var f={};g(j(h),function(a){f[a]=h[a]}),f[c]=e,b(a,f),b=function(){}}else h[c]=e,d.setImmediate(n)},o=e.slice(0,Math.abs(e.length-1))||[],p=function(){return i(o,function(a,b){return a&&h.hasOwnProperty(b)},!0)&&!h.hasOwnProperty(c)};if(p())e[e.length-1](k,h);else{var q=function(){p()&&(m(q),e[e.length-1](k,h))};l(q)}})},d.retry=function(a,b,c){var e=5,f=[];"function"==typeof a&&(c=b,b=a,a=e),a=parseInt(a,10)||e;var g=function(e,g){for(var h=function(a,b){return function(c){a(function(a,d){c(!a||b,{err:a,result:d})},g)}};a;)f.push(h(b,!(a-=1)));d.series(f,function(a,b){b=b[b.length-1],(e||c)(b.err,b.result)})};return c?g():g},d.waterfall=function(a,b){if(b=b||function(){},!f(a)){var c=new Error("First argument to waterfall must be an array of functions");return b(c)}if(!a.length)return b();var e=function(a){return function(c){if(c)b.apply(null,arguments),b=function(){};else{var f=Array.prototype.slice.call(arguments,1),g=a.next();f.push(g?e(g):b),d.setImmediate(function(){a.apply(null,f)})}}};e(d.iterator(a))()};var t=function(a,b,c){if(c=c||function(){},f(b))a.map(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},c);else{var d={};a.each(j(b),function(a,c){b[a](function(b){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),d[a]=e,c(b)})},function(a){c(a,d)})}};d.parallel=function(a,b){t({map:d.map,each:d.each},a,b)},d.parallelLimit=function(a,b,c){t({map:p(b),each:k(b)},a,c)},d.series=function(a,b){if(b=b||function(){},f(a))d.mapSeries(a,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},b);else{var c={};d.eachSeries(j(a),function(b,d){a[b](function(a){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),c[b]=e,d(a)})},function(a){b(a,c)})}},d.iterator=function(a){var b=function(c){var d=function(){return a.length&&a[c].apply(null,arguments),d.next()};return d.next=function(){return c<a.length-1?b(c+1):null},d};return b(0)},d.apply=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b.concat(Array.prototype.slice.call(arguments)))}};var u=function(a,b,c,d){var e=[];a(b,function(a,b){c(a,function(a,c){e=e.concat(c||[]),b(a)})},function(a){d(a,e)})};d.concat=l(u),d.concatSeries=n(u),d.whilst=function(a,b,c){a()?b(function(e){return e?c(e):void d.whilst(a,b,c)}):c()},d.doWhilst=function(a,b,c){a(function(e){if(e)return c(e);var f=Array.prototype.slice.call(arguments,1);b.apply(null,f)?d.doWhilst(a,b,c):c()})},d.until=function(a,b,c){a()?c():b(function(e){return e?c(e):void d.until(a,b,c)})},d.doUntil=function(a,b,c){a(function(e){if(e)return c(e);var f=Array.prototype.slice.call(arguments,1);b.apply(null,f)?c():d.doUntil(a,b,c)})},d.queue=function(b,c){function e(a,b,c,e){return a.started||(a.started=!0),f(b)||(b=[b]),0==b.length?d.setImmediate(function(){a.drain&&a.drain()}):void g(b,function(b){var f={data:b,callback:"function"==typeof e?e:null};c?a.tasks.unshift(f):a.tasks.push(f),a.saturated&&a.tasks.length===a.concurrency&&a.saturated(),d.setImmediate(a.process)})}void 0===c&&(c=1);var h=0,i={tasks:[],concurrency:c,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(a,b){e(i,a,!1,b)},kill:function(){i.drain=null,i.tasks=[]},unshift:function(a,b){e(i,a,!0,b)},process:function(){if(!i.paused&&h<i.concurrency&&i.tasks.length){var c=i.tasks.shift();i.empty&&0===i.tasks.length&&i.empty(),h+=1;var d=function(){h-=1,c.callback&&c.callback.apply(c,arguments),i.drain&&i.tasks.length+h===0&&i.drain(),i.process()},e=a(d);b(c.data,e)}},length:function(){return i.tasks.length},running:function(){return h},idle:function(){return i.tasks.length+h===0},pause:function(){i.paused!==!0&&(i.paused=!0,i.process())},resume:function(){i.paused!==!1&&(i.paused=!1,i.process())}};return i},d.priorityQueue=function(a,b){function c(a,b){return a.priority-b.priority}function e(a,b,c){for(var d=-1,e=a.length-1;e>d;){var f=d+(e-d+1>>>1);c(b,a[f])>=0?d=f:e=f-1}return d}function h(a,b,h,i){return a.started||(a.started=!0),f(b)||(b=[b]),0==b.length?d.setImmediate(function(){a.drain&&a.drain()}):void g(b,function(b){var f={data:b,priority:h,callback:"function"==typeof i?i:null};a.tasks.splice(e(a.tasks,f,c)+1,0,f),a.saturated&&a.tasks.length===a.concurrency&&a.saturated(),d.setImmediate(a.process)})}var i=d.queue(a,b);return i.push=function(a,b,c){h(i,a,b,c)},delete i.unshift,i},d.cargo=function(a,b){var c=!1,e=[],i={tasks:e,payload:b,saturated:null,empty:null,drain:null,drained:!0,push:function(a,c){f(a)||(a=[a]),g(a,function(a){e.push({data:a,callback:"function"==typeof c?c:null}),i.drained=!1,i.saturated&&e.length===b&&i.saturated()}),d.setImmediate(i.process)},process:function j(){if(!c){if(0===e.length)return i.drain&&!i.drained&&i.drain(),void(i.drained=!0);var d="number"==typeof b?e.splice(0,b):e.splice(0,e.length),f=h(d,function(a){return a.data});i.empty&&i.empty(),c=!0,a(f,function(){c=!1;var a=arguments;g(d,function(b){b.callback&&b.callback.apply(null,a)}),j()})}},length:function(){return e.length},running:function(){return c}};return i};var v=function(a){return function(b){var c=Array.prototype.slice.call(arguments,1);b.apply(null,c.concat([function(b){var c=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(b?console.error&&console.error(b):console[a]&&g(c,function(b){console[a](b)}))}]))}};d.log=v("log"),d.dir=v("dir"),d.memoize=function(a,b){var c={},e={};b=b||function(a){return a};var f=function(){var f=Array.prototype.slice.call(arguments),g=f.pop(),h=b.apply(null,f);h in c?d.nextTick(function(){g.apply(null,c[h])}):h in e?e[h].push(g):(e[h]=[g],a.apply(null,f.concat([function(){c[h]=arguments;var a=e[h];delete e[h];for(var b=0,d=a.length;d>b;b++)a[b].apply(null,arguments)}])))};return f.memo=c,f.unmemoized=a,f},d.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}},d.times=function(a,b,c){for(var e=[],f=0;a>f;f++)e.push(f);return d.map(e,b,c)},d.timesSeries=function(a,b,c){for(var e=[],f=0;a>f;f++)e.push(f);return d.mapSeries(e,b,c)},d.seq=function(){var a=arguments;return function(){var b=this,c=Array.prototype.slice.call(arguments),e=c.pop();d.reduce(a,c,function(a,c,d){c.apply(b,a.concat([function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);d(a,b)}]))},function(a,c){e.apply(b,[a].concat(c))})}},d.compose=function(){return d.seq.apply(null,Array.prototype.reverse.call(arguments))};var w=function(a,b){var c=function(){var c=this,d=Array.prototype.slice.call(arguments),e=d.pop();return a(b,function(a,b){a.apply(c,d.concat([b]))},e)};if(arguments.length>2){var d=Array.prototype.slice.call(arguments,2);return c.apply(this,d)}return c};d.applyEach=l(w),d.applyEachSeries=n(w),d.forever=function(a,b){function c(d){if(d){if(b)return b(d);throw d}a(c)}c()},"undefined"!=typeof module&&module.exports?module.exports=d:"undefined"!=typeof define&&define.amd?define([],function(){return d}):b.async=d}();var Wires=Wires||{};!function(){var a=function(a,b){var c,d=this;c=a&&_.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},_.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&_.extend(c.prototype,a),c.__super__=d.prototype,c.prototype.__parent__=function(a,b){c.__super__[a].apply(c.prototype,b)},c},b=function(){this.initialize.apply(this,arguments)};b.extend=a,Wires.Class=b}(),Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(a,b){var c=this[a],d=c,e=function(){return d},f=function(e){return c=d,d=b.call(this,a,c,e)};delete this[a]&&Object.defineProperty(this,a,{get:e,set:f,enumerable:!0,configurable:!0})}}),id_counter=1,Object.defineProperty(Object.prototype,"__uniqueId",{writable:!0}),Object.defineProperty(Object.prototype,"uniqueId",{get:function(){return void 0==this.__uniqueId&&(this.__uniqueId=id_counter++),this.__uniqueId}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(a){var b=this[a];delete this[a],this[a]=b}}),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();var Wires=Wires||{};!function(){"use strict";Wires.Acts=function(a){this.node=a}}();var Wires=Wires||{};!function(){"use strict";Wires.Acts.prototype.toggle=function(a,b){var c=this.node.scope.instance;void 0===b?b=a:c=a,c[b]=c[b]?!1:!0}}();var Wires=Wires||{};!function(){"use strict";Wires.Node=Wires.Class.extend({bindEssentials:function(a){var b=this;this.variables=Wires.Variable.extract(this.scope,a),this.template=a,this.variables&&_.each(this.variables,function(a){Wires.Watcher.spy(b.scope,a,b)})},compileValue:function(a,b){var c=this.template,d={};return _.each(this.variables,function(e){var f=e.getValue(a,b);void 0!==b&&(f=e.equalsTo(a)?b:f),void 0!==f&&(d[e.tag]=f,c=c.split(e.name).join(void 0!==f?f.toString():""))}),c}})}();var Wires=Wires||{};!function(){"use strict";Wires.Attr=Wires.Node.extend({initialize:function(a,b,c,d){this.instance=a.instance,this.scope=a,this.element=c,this.attr=d,this.bindEssentials(this.attr.value)},setValue:function(a,b){var c=this.compileValue(a,b);this.attr.value=c},executeStatement:function(a,b,c){return Wires.Exec.expression({statement:this.attr.value,incomingVar:a,resultNeeded:c,newValue:b,scope:this.scope,variables:this.variables})}},{claimsChildren:!1,addAttibute:!0})}();var Wires=Wires||{};!function(){"use strict";Wires.TextNode=Wires.Node.extend({initialize:function(a,b,c){this.dom=b,this.scope=a,this.instance=a.instance,this.element=document.createTextNode(this.dom.data),this.bindEssentials(b.data);var d=this;c.appendChild(d.element),b.children&&Wires.World.parse(a,b.children,this.element)},setValue:function(a,b){var b=this.compileValue(a,b);this.element.nodeValue=b},getElement:function(){return this.element}})}();var Wires=Wires||{};!function(){"use strict";Wires.TagNode=Wires.Node.extend({initialize:function(a,b,c,d){var e=this;this.dom=b,this.scope=a,this.instance=a.instance,this.attributes=[],this.element=this.getElement(),d&&d.insertBefore?($(this.element).insertBefore(d.insertBefore),Wires.World.parse(a,b.children,this.element)):(b.children&&!this.attributeClamsChildren&&Wires.World.parse(a,b.children,this.element),this.shouldAppendElement?c.appendChild(this.element):(this.placeholder=document.createComment(""),c.appendChild(this.placeholder))),_.each(this.attributes,function(a){a.onElementReady&&a.onElementReady(e)})},bindAttribute:function(a,b){new Wires.Attr(this.scope,this.dom,b,a)},getElement:function(){var a=document.createElement(this.dom.name),b=this;this.shouldAppendElement=!0;var c=[];return _.each(this.dom.attribs,function(d,e){var f=document.createAttribute(e);f.value=d;var g=!0;if(Wires.attrs[e]){var h=Wires.attrs[e];c.push({handler:h,attr:f}),h.claimsChildren===!0&&(b.attributeClamsChildren=!0),void 0!==h.shouldAppendElement&&(b.shouldAppendElement=h.shouldAppendElement),g=h.addAttibute}else d.indexOf("$")>-1&&b.bindAttribute(f,a);g&&a.setAttributeNode(f)}),_.each(c,function(c){b.attributes.push(new c.handler(b.scope,b.dom,a,c.attr,b))}),a}})}();var Wires=Wires||{};!function(){"use strict";Wires.World=Wires.Class.extend({initialize:function(a){this.template=a.template,this.target=a.target,this.scope=a.scope;var b=this,c=new Tautologistics.NodeHtmlParser.DefaultHandler(function(a,c){a?console.log(a):Wires.World.parse(b.scope,c,b.target)}),d=new Tautologistics.NodeHtmlParser.Parser(c);d.parseComplete(this.template)}},{cleanUp:function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},attachParents:function(a,b,c){var d=a.instance,e={instance:b,parents:[d],parent:a.instance,param:c};return a.parents&&(e.parents=_.union(e.parents,a.parents)),e},parse:function(a,b,c,d){_.each(b,function(b){"text"===b.type&&new Wires.TextNode(a,b,c,d),"tag"===b.type&&new Wires.TagNode(a,b,c,d)})},registerAttribute:function(){}})}();var Wires=Wires||{};!function(){"use strict";Wires.Exec=Wires.Class.extend({},{expression:function(options){var statement=options.statement,incomingVar=options.incomingVar,resultNeeded=void 0!==options.resultNeeded?options.resultNeeded:!0,newValue=options.newValue,scope=options.scope,variables=options.variables,data={};_.each(variables,function(a){var b=a.getValue?a.getValue():a;void 0===newValue||a.service||(b=a.equalsTo(incomingVar)?newValue:b);var c=a.name.replace(/[\[.\]]/gi,"_");data[c]=b,statement=statement.split(a.name).join(c)});var func="(function("+_.keys(data)+"){ "+(resultNeeded?"return":"")+" "+statement+"})",result="",_this=this.getThisPointer(scope);try{result=eval(func).apply(_this,_.values(data))}catch(e){this.failedMessage(e,{message:"Failed to execute expression",code:statement,scope:scope,variables:data})}return result},variable:function(param){return eval("(function(){return this."+param+"})")},getThisPointer:function(a){var b=a.instance;return(a.parent||a.parents)&&(b={},b[a.param]=a.instance,b.parent=a.parent,b.parents=a.parents),b},failedMessage:function(a,b){console.groupCollapsed(b.message,b.param||""),console.error(a.message),b.code&&console.error(b.code),b.variables&&console.error("Local variables",b.variables),b.target&&(console.error("Destination instance:",b.target||{}),console.error("Destination property:",b.target.property||{})),console.error("Registered scope:",b.scope||{}),b.scope&&b.scope.parent&&console.info("Maybe you meant $parent?"),console.groupEnd()}})}();var Wires=Wires||{};!function(){"use strict";var a=function(a,b){var c=new RegExp(/^(parent\.|parents\[(\d{1,4})\]\.)/m),d=a.match(c),e=b.instance;if(d){var f;(f=parseInt(d[2]))>0?b.parent&&b.parents.length>=f&&(e=b.parents[f]):e=b.parent,a=a.replace(c,"")}return{instance:e,path:a}},b=function(b,c){var d=a(c,b),e=d.instance,f=d.path,c=f.split(".");
if(1===c.length)return{instance:e,property:c[0]};var g=e,h=null;return _.each(c,function(a,b){void 0!==g[a]&&b<c.length-1&&(g=g[a]),b===c.length-1&&(h=a)}),{instance:g,property:h}};Wires.Variable=Wires.Class.extend({initialize:function(a,c,d){return this.instance=a.instance,this.parent=a.parent,this.scope=a,this.isFunction=!1,this.name=c,d?(this.expression=c.replace("{#","").replace("#}",""),void(this.expressionVariables=d.variables)):(this.param=c.substring(1),c.indexOf("(")>-1&&(this.isFunction=!0),this.target=b(this.scope,this.param),void this.compileFunction())},compileFunction:function(){this.compiledFunction=Wires.Exec.variable(this.param)},equalsTo:function(a){return this.target&&a.target&&this.target.instance.uniqueId==a.target.instance.uniqueId&&this.target.param==a.target.param?!0:a.name===this.name},_executeFunction:function(){var a=this.compiledFunction,b=Wires.Exec.getThisPointer(this.scope),c="";try{c=a.apply(b)}catch(d){Wires.Exec.failedMessage(d,{message:"Failed to execute",param:this.expression?this.expression:this.param,target:this.target,scope:this.scope})}return c},getValue:function(a,b){return this.expression?Wires.Exec.expression({statement:this.expression,incomingVar:a,newValue:b,scope:this.scope,variables:this.expressionVariables}):_.isObject(this.target.instance)?this.isFunction||void 0===this.target.instance[this.target.property]?this.isFunction?this._executeFunction():"":this._executeFunction():this.target.instance},setValue:function(a){this.target.instance[this.target.property]=a}},{extract:function(a,b){var c=b.match(/(\$[a-zA-Z0-9_.\[\]]+(\([$\w,\s'".]*\))?)/g),d=[];c&&(c=_.uniq(c),_.each(c,function(b){d.push(new Wires.Variable(a,b))}));var e=[];c=b.match(/(\{#(.+?)#\})/g),c&&(c=_.uniq(c),_.each(c,function(b){e.push(new Wires.Variable(a,b,{variables:d}))}));var f=[];return _.each(e,function(a){f.push(a)}),_.each(d,function(a){f.push(a)}),f}})}();var Wires=Wires||{};!function(){"use strict";Wires.Watcher=Wires.Class.extend({initialize:function(a,b){if(this.nodeCollection={},this.index=1,this.node=a,this.variable=b,!this.variable.isFunction&&!this.variable.expression){var c=b.target.instance,d=b.target.property;c.watch(d,function(a,b,c){return this.valueChanged(c),c}.bind(this))}},valueChanged:function(a){var b=this;_.each(this.nodeCollection,function(c){c.setValue(b.variable,a)})},setInitial:function(a){a.setValue(this.variable,void 0,!0)},add:function(a){{var b=this.index++;a.element}this.nodeCollection[b]=a}},{collections:{},unwatch:function(a,b,c){console.log("unwatch",b,c.element)},spy:function(a,b,c){var d=a.instance,e=b.name;if(!b.expression){var e=b.target&&b.target.property?b.target.property:b.name;d=b.target&&b.target.instance?b.target.instance:d;var f=d.uniqueId;if(!this.collections[d.uniqueId]){var g=new Wires.Watcher(c,b);this.collections[f]=g}this.collections[f][e]||(this.collections[f][e]=new Wires.Watcher(c,b));var h=this.collections[f][e];h.add(c),h.setInitial(c)}}})}();var Wires=Wires||{};Wires.attrs=Wires.attrs||{},function(){"use strict";Wires.BaseAttribute=Wires.Attr.extend({initialize:function(a,b,c,d,e){this.scope=a,this.node=e,this.instance=a.instance,this.element=c,this.attr=d,this.condition=this.attr.value,this.addAttibute=!1,this.bindEssentials(this.condition)},setValue:function(){}},{addAttibute:!1})}();var Wires=Wires||{};Wires.attrs=Wires.attrs||{},function(){"use strict";Wires.attrs["if"]=Wires.BaseAttribute.extend({initialize:function(){Wires.attrs["if"].__super__.initialize.apply(this,arguments)},onElementReady:function(){this.node.placeholder.nodeValue="wires-if: "+this.condition},setValue:function(a,b){var c=this.executeStatement(a,b,"return"),d=$(this.element);c?d.insertBefore(this.node.placeholder):d.remove()}},{shouldAppendElement:!1})}();var Wires=Wires||{};Wires.attrs=Wires.attrs||{},function(){"use strict";Wires.attrs.visible=Wires.BaseAttribute.extend({setValue:function(a,b){var c=this.executeStatement(a,b,"return"),d=$(this.element).data("animation"),e=$(this.element);switch(d){case"slide":c?e.slideDown():e.slideUp();break;case"fade":c?e.fadeIn():e.fadeOut();break;default:c?e.show():e.hide()}}})}();var Wires=Wires||{};Wires.attrs=Wires.attrs||{},function(){Wires.attrs.each=Wires.Attr.extend({initialize:function(a,b,c,d,e){this.instance=a.instance,this.scope=a,this.element=c,this.attr=d,this.node=e,this.dom=b,this.condition=this.attr.value,this.essentials=this.getEssentials(),this.bindArrayEvents(this.essentials.collection),Wires.Watcher.spy(this.instance,this.essentials.collection,this)},addItem:function(a,b){b||(b=this.getArrayLength()),a[this.essentials.key.name]=b,a.parent=this.instance;var c=this,d=Wires.World.attachParents(this.scope,a,c.essentials.value.param);Wires.World.parse(d,this.dom.children,this.element)},bindArrayEvents:function(a){this.array=a.getValue(),_.isArray(this.array)&&(this.array._WiresEach||(this.array._WiresEach=[],this.array.push=function(){var a=arguments.length>0?arguments[0]:null;return a&&_.each(this._WiresEach,function(b){b.addItem(a)}),Array.prototype.push.apply(this,arguments)}),this.array._WiresEach.push(this))},getArrayLength:function(){return this.array.length},getEssentials:function(){var a=Wires.Variable.extract(this.scope,this.condition);return a.length<2?void console.error("Can't recognize expression!"):{value:a[0],key:3===a.length?a[1]:{name:"index",tag:"$index"},collection:a[3===a.length?2:1]}},setValue:function(a,b){var c=this,d=b?b:a.getValue();_.isArray(d)&&c.dom.children&&_.each(d,function(a,b){c.addItem(a,b)})}},{claimsChildren:!0,addAttibute:!1})}();var Wires=Wires||{};Wires.attrs=Wires.attrs||{},function(){Wires.attrs.repeat=Wires.attrs.each.extend({initialize:function(){Wires.attrs.repeat.__super__.initialize.apply(this,arguments)},onElementReady:function(){this.node.placeholder.nodeValue="wires-repeat: "+this.condition,this.delayedAddFunction&&(this.delayedAddFunction(),this.delayedAddFunction=void 0)},addItem:function(a,b){b||(b=this.getArrayLength()),a[this.essentials.key.name]=b,a.parent=this.instance;var c=this,d=this.dom;delete d.attribs.repeat;var e=[d],f=Wires.World.attachParents(this.scope,a,c.essentials.value.param);Wires.World.parse(f,e,this.element,{insertBefore:this.node.placeholder})},setValue:function(a,b,c){c?this.delayedAddFunction=function(){Wires.attrs.repeat.__super__.setValue.apply(this._this,this.args)}.bind({_this:this,args:arguments}):Wires.attrs.repeat.__super__.setValue.apply(this,arguments)}},{shouldAppendElement:!1})}();var Wires=Wires||{};Wires.attrs=Wires.attrs||{},function(){"use strict";Wires.attrs.value=Wires.Attr.extend({initialize:function(a,b,c){Wires.attrs.value.__super__.initialize.apply(this,arguments),this.element=c,this.scope=a,this.instance=a.instance,this.bindChanges()},bindChanges:function(){var a=this,b=this.element.nodeName.toLowerCase(),c=$(this.element).attr("type");switch("textarea"===b&&(c=b),"select"===b&&(c=b),c){case"text":case"email":case"password":case"textarea":this.element.addEventListener("keydown",function(){clearInterval(a.interval),a.interval=setTimeout(function(){a.variables.length>0&&(a.ignoreNodeSetValue=!0,a.variables[0].setValue(this.value,{ignore:this.element}))}.bind(this),50)},!1);break;case"checkbox":this.element.addEventListener("click",function(){var b=this.checked;a.ignoreNodeSetValue=!0,a.variables[0].setValue(b)});break;case"select":$(this.element).bind("change",function(){var b=$(this).val();a.ignoreNodeSetValue=!0,a.variables[0].setValue(b),console.log("changed")})}},setValue:function(a,b){if(this.ignoreNodeSetValue)return void(this.ignoreNodeSetValue=!1);var c=this.executeStatement(a,b,"return"),d=this.element.getAttribute("type");"checkbox"===d?this.element.checked=c:this.element.value=c}},{addAttibute:!1})}();var Wires=Wires||{};Wires.attrs=Wires.attrs||{},function(){"use strict";Wires.attrs.click=Wires.Attr.extend({initialize:function(a,b,c,d){this.scope=a,this.element=c,this.attr=d,this.condition=this.attr.value,this.bindEssentials(this.condition);var e=this,f=new Wires.Acts(e);this.variables.push({getValue:function(){return f},service:!0,name:"act"}),this.bindEvents()},bindEvents:function(){var a=this;$(this.element).click(function(){a.executeStatement.bind(a)("","",!1)})},setValue:function(){}},{addAttibute:!1})}();var Wires=Wires||{};Wires.attrs=Wires.attrs||{},function(){"use strict";Wires.attrs.animation=Wires.BaseAttribute.extend({initialize:function(){Wires.attrs.animation.__super__.initialize.apply(this,arguments);var a=this.attr.value;$(this.element).data("animation",a)},setValue:function(){}})}();var Wires=Wires||{};Wires.attrs=Wires.attrs||{},function(){"use strict";Wires.attrs.submit=Wires.BaseAttribute.extend({initialize:function(){this.__parent__("initialize",arguments),this.setBindings()},setBindings:function(){var a=this;$(this.element).submit(function(b){a.executeStatement(),b.originalEvent.preventDefault()})},setValue:function(){}})}();var Wires=Wires||{};Wires.attrs=Wires.attrs||{},function(){"use strict";Wires.attrs.selected=Wires.BaseAttribute.extend({initialize:function(){Wires.attrs.selected.__super__.initialize.apply(this,arguments)},setValue:function(a,b){var c=this.executeStatement(a,b,"return"),d=$(this.element);c?d.attr("selected",""):d.removeAttr("selected")}},{addAttibute:!1})}(),Wires.MVC=Wires.MVC||{},function(){"use strict";Wires.MVC.templateCollection={},Wires.MVC.openedTemplate,Wires.MVC.createdViews={},Wires.MVC.createdControllers={},Wires.MVC.controllerTemplates={},Wires.MVC.interceptors={},Wires.MVC.registeredControllers=[],Wires.MVC.collectionsInstances={},Wires.MVC.rest={_send:function(a,b){$.ajax({type:a.type,url:a.url,data:b,dataType:"json",success:a.success,error:function(b){var c=JSON.parse(b.response);a.error(c)}})},get:function(a,b,c){this._send({type:"GET",url:a,success:b,error:c})},post:function(a,b,c){this._send({type:"POST",url:a,success:b,error:c})},del:function(a,b,c){this._send({type:"DELETE",url:a,success:b,error:c})}},Wires.MVC.ControllerInterceptor=function(a,b){var c=a.interceptors||{},d=[];_.each(c,function(a,b){Wires.MVC.interceptors[b]||(Wires.MVC.interceptors[b]=new a),Wires.MVC.interceptors[b].call&&d.push(function(a){Wires.MVC.interceptors[this.name].call(a)}.bind({name:b}))}),async.waterfall(d,b)},Wires.MVC.getURLParameters=function(){var a=window.location.hash.replace("#","/"),b=a.split("/");b.splice(0,1);var c={controller:b.length>=1?b[0]:"main",action:b.length>=2?b[1]:"index",id:b.length>=3?b[2]:null};return c},Wires.MVC.onHistory=function(a){$(window).on("hashchange",function(){a(Wires.MVC.getURLParameters())})},Wires.MVC.Essentials=function(a,b,c){var d,b=b||"index",e=a.essentials||{},f=e.views||{},g=e.collections||{},h=e.containers?e.containers["*"]||e.containers[b]:"#content",i=f[b]||null,j=[];i&&j.push(function(a){Wires.MVC.fetchTemplate(i,function(b){d=b,a()})}),a.collections=a.collections||{},_.each(g,function(b,c){j.push(function(c){var d=this.name;Wires.MVC.collections(d,b,function(b){a.collections[d]=b,c()})}.bind({name:c}))}),async.waterfall(j,function(){c({tpl:d,container:h})})},Wires.MVC.ExecuteTarget=function(a,b){a._currentMethod=b,Wires.MVC.Essentials(a,b,function(c){$(c.container).hide(),Wires.World.cleanUp($(c.container)[0]),a[b](Wires.MVC.getURLParameters(),function(){a.attach.bind(a)(c)})})},Wires.MVC.Router=function(){this.routes=[],this.controllers={},this.fetchEssentials=function(a,b){Wires.MVC.Essentials(a,this.params.action,b)},this.register=function(a,b){Wires.MVC.registeredControllers.push({path:a,controller:b}),this.routes.push({path:a?a:"main",controller:b})},this._start=function(a){var b=this;this.params=a;try{_.each(this.routes,function(c){_.isString(c.path)?c.path===a.controller&&b.executeController.bind(b)(c):b.url.match(c.path)&&b.executeController.bind(b)(c)})}catch(c){console.log("error",c.stack?c.stack:c)}},this.start=function(){this._start(Wires.MVC.getURLParameters()),Wires.MVC.onHistory(this._start.bind(this))},this.createController=function(a,b){if(!Wires.MVC.createdControllers[a.path]){var c=new a.controller;Wires.MVC.createdControllers[a.path]=c}var c=Wires.MVC.createdControllers[a.path];Wires.MVC.ControllerInterceptor(c,function(){b(c)})},this.executeController=function(a){this.createController(a,function(a){a[this.params.action]&&Wires.MVC.ExecuteTarget(a,this.params.action)}.bind(this))}},Wires.MVC.fetchTemplate=function(a,b){Wires.MVC.controllerTemplates[a]?b(Wires.MVC.controllerTemplates[a]):$.get("/app/views/"+a,function(c){var d=[],e=c.match(/\{\{\s?include (.*?)\}\}/gi);_.each(e,function(a){var b=a.match("include (.*?)}}")[1];d.push(function(d){Wires.MVC.fetchTemplate(b,function(b){c=c.split(a).join(b),d()})})}),async.waterfall(d,function(){Wires.MVC.controllerTemplates[a]=c,b(c)})})},Wires.MVC.Layout=Wires.Class.extend({template:function(a,b,c){var d=this;Wires.MVC.fetchTemplate(a,function(a){$(c).hide(),b.bind(d)(function(b){d.attach.bind(d)({container:c,tpl:a,afterDone:b})})})},attach:function(a){this.beforeRender&&this.beforeRender(Wires.MVC.getURLParameters());var b=a.afterDone||function(){},c=$(a.container);if(c[0]){c.show();{var d=this;new Wires.World({template:a.tpl,scope:{instance:d},target:c[0]})}b(),this.afterRender()}else console.error(a.container,"was not found in DOM"),console.error("Cannot render instance ",this)},afterRender:function(){var a=this.essentials||{},b=a.components||[],c=b[this._currentMethod]||{},d=this;_.each(c,function(a,b){var c=_.isString(a)?app[a]:a,e=new c;e.render(),d[b]=e})}},{displayName:""}),Wires.MVC.Component=Wires.MVC.Layout.extend({initialize:function(a){this.essentials=this.essentials||{},this.options=a||{},a&&a.container&&(this.essentials.containers={index:a.container});var b=this;_.each(a,function(a,c){b[c]=a}),Wires.MVC.Component.__super__.initialize.apply(this,arguments)},render:function(){Wires.MVC.ExecuteTarget(this,"index")}}),Wires.MVC.Controller=Wires.MVC.Layout.extend({initialize:function(){}})}();